import{j as e}from"./job-api-D-3ZlMQ3.js";import{T as a,P as t,s as l,S as o}from"./index-CBkxY9s9.js";import{_ as i}from"./index.vue_vue_type_script_setup_true_lang-CtW6JKpO.js";import{T as s}from"./table-id-const-DES3cCFe.js";import{_ as r}from"./deleted-job-list.vue_vue_type_script_setup_true_lang-C0jPEI5p.js";import{_ as n}from"./job-form-modal.vue_vue_type_script_setup_true_lang-CZIwGgA4.js";import{_ as d}from"./job-log-list-modal.vue_vue_type_script_setup_true_lang-CLQIKt4q.js";import{b as u,M as p}from"./ant-design-vue-CcohkicM.js";import{d as c,r as m,a as g,e as b,b2 as y,z as f,b as j,o as _,c as v,bz as h,ai as k,F as x,b0 as w,ag as I,J as C,be as T,y as S,u as z,ah as J}from"./@vue-BVvo-xZd.js";import"./@ant-design-D2dl84QQ.js";import"./vue-Bbq_A2bw.js";import"./@ctrl-DlzbjsCp.js";import"./lodash-2VbGH-WW.js";import"./vue3-json-viewer-DGFKKWPN.js";import"./dayjs-B6vKC6dp.js";import"./vue-i18n-CEbWPeBD.js";import"./@intlify-D18cTrFw.js";import"./pinia-CgN6MZDh.js";import"./axios-BlN9Xwzv.js";import"./crypto-js-TV0Ce7JK.js";import"./sm-crypto-CWaozmhJ.js";import"./jsbn-DBh4-X7k.js";import"./nprogress-CqoNXQnd.js";import"./vue-router-D-yLC68c.js";import"./mitt-CNZ6avp8.js";import"./@babel-rSvM8Ko2.js";import"./resize-observer-polyfill-OVnto9HH.js";import"./@emotion-DXlYAqfy.js";import"./stylis-YutRQeBK.js";import"./vue-types-Sy1fKJ9U.js";import"./dom-align-CCb293uS.js";import"./lodash-es-BgZ_dRTG.js";import"./async-validator-BTKOuuO-.js";import"./throttle-debounce-w9OM8Bxz.js";import"./sortablejs-CRp0PNdb.js";const E={class:"smart-table-setting-block smart-margin-bottom10"},F={key:0},L=k("div",null,"下次执行(预估时间)",-1),q={key:5,class:"smart-table-operate"},O={class:"smart-query-table-page"},U=c({__name:"job-list",setup(c){const U=m("1"),N=m([{title:"id",width:50,dataIndex:"jobId"},{title:"任务名称",dataIndex:"jobName",minWidth:150,ellipsis:!0},{title:"执行类",dataIndex:"jobClass",minWidth:180,ellipsis:!0},{title:"触发类型",dataIndex:"triggerType",width:110},{title:"触发配置",dataIndex:"triggerValue",width:150},{title:"上次执行",width:180,dataIndex:"lastJob"},{title:"下次执行",width:150,dataIndex:"nextJob"},{title:"启用状态",dataIndex:"enabledFlag",width:100},{title:"执行参数",dataIndex:"param",ellipsis:!0},{title:"任务描述",dataIndex:"remark",ellipsis:!0},{title:"排序",dataIndex:"sort",width:65},{title:"更新人",dataIndex:"updateName",width:90},{title:"更新时间",dataIndex:"updateTime",width:150},{title:"操作",dataIndex:"action",fixed:"right",width:170}]),D={searchWord:"",enabledFlag:null,triggerType:null,deletedFlag:!1,pageNum:1,pageSize:10},P=g({...D}),R=m(!1),M=m([]),W=m(0);function V(){Object.assign(P,D),$()}function K(){P.pageNum=1,$()}async function $(){try{R.value=!0;let a=await e.queryJob(P);const t=a.data.list;W.value=a.data.total,M.value=t}catch(a){l.captureError(a)}finally{R.value=!1}}async function A(a,t){t.enabledLoading=!0;try{let o={jobId:t.jobId,enabledFlag:a};await e.updateJobEnabled(o);let i=await async function(a){try{return(await e.queryJobInfo(a)).data}catch(t){l.captureError(t)}}(t.jobId);Object.assign(t,i),u.success("更新成功")}catch(o){t.enabledFlag=!a,l.captureError(o)}finally{t.enabledLoading=!1}}b($);const G=m();function Y(a,t){p.confirm({title:"警告",content:`确定要删除【${t}】任务吗?`,okText:"删除",okType:"danger",onOk(){!async function(a){try{o.show(),await e.deleteJob(a),u.success("删除成功!"),$()}catch(t){l.captureError(t)}finally{o.hide()}}(a)},cancelText:"取消",onCancel(){}})}const B=m();function Q(e){B.value.openUpdateModal(e)}return(e,l)=>{const o=y("a-input"),u=y("a-form-item"),p=y("a-select-option"),c=y("a-select"),m=y("SearchOutlined"),g=y("a-button"),b=y("ReloadOutlined"),D=y("a-button-group"),X=y("plus-outlined"),H=y("a-row"),Z=y("a-form"),ee=y("a-flex"),ae=y("a-tooltip"),te=y("a-tag"),le=y("CheckOutlined"),oe=y("WarningOutlined"),ie=y("a-switch"),se=y("a-table"),re=y("a-pagination"),ne=y("a-tab-pane"),de=y("a-tabs"),ue=y("a-card"),pe=f("privilege");return _(),j("div",null,[v(ue,{size:"small",bordered:!1,hoverable:!0},{default:h((()=>[v(de,{activeKey:U.value,"onUpdate:activeKey":l[7]||(l[7]=e=>U.value=e)},{default:h((()=>[v(ne,{key:"1",tab:"有效任务"},{default:h((()=>[v(Z,{class:"smart-query-form"},{default:h((()=>[v(H,{class:"smart-query-form-row"},{default:h((()=>[v(u,{label:"关键字",class:"smart-query-form-item"},{default:h((()=>[v(o,{style:{width:"200px"},value:P.searchWord,"onUpdate:value":l[0]||(l[0]=e=>P.searchWord=e),placeholder:"请输入关键字",maxlength:30},null,8,["value"])])),_:1}),v(u,{label:"触发类型",class:"smart-query-form-item"},{default:h((()=>[v(c,{style:{width:"155px"},value:P.triggerType,"onUpdate:value":l[1]||(l[1]=e=>P.triggerType=e),placeholder:"请选择触发类型",allowClear:""},{default:h((()=>[(_(!0),j(x,null,w(e.$smartEnumPlugin.getValueDescList("TRIGGER_TYPE_ENUM"),(e=>(_(),I(p,{key:e.value,value:e.value},{default:h((()=>[C(T(e.desc),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"])])),_:1}),v(u,{label:"状态",class:"smart-query-form-item"},{default:h((()=>[v(c,{style:{width:"150px"},value:P.enabledFlag,"onUpdate:value":l[2]||(l[2]=e=>P.enabledFlag=e),placeholder:"请选择状态",allowClear:""},{default:h((()=>[(_(),I(p,{key:1},{default:h((()=>[C(" 开启 ")])),_:1})),(_(),I(p,{key:0},{default:h((()=>[C(" 停止 ")])),_:1}))])),_:1},8,["value"])])),_:1}),v(u,{class:"smart-query-form-item smart-margin-left10"},{default:h((()=>[v(D,null,{default:h((()=>[S((_(),I(g,{type:"primary",onClick:K},{icon:h((()=>[v(m)])),default:h((()=>[C(" 查询 ")])),_:1})),[[pe,"support:job:query"]]),S((_(),I(g,{onClick:V},{icon:h((()=>[v(b)])),default:h((()=>[C(" 重置 ")])),_:1})),[[pe,"support:job:query"]])])),_:1}),S((_(),I(g,{class:"smart-margin-left20",type:"primary",onClick:l[3]||(l[3]=e=>Q())},{icon:h((()=>[v(X)])),default:h((()=>[C(" 添加任务 ")])),_:1})),[[pe,"support:job:add"]])])),_:1})])),_:1})])),_:1}),v(ee,{align:"end",vertical:""},{default:h((()=>[k("div",E,[v(i,{class:"smart-margin-bottom5 pull-right",modelValue:N.value,"onUpdate:modelValue":l[4]||(l[4]=e=>N.value=e),tableId:z(s).SUPPORT.JOB,refresh:$},null,8,["modelValue","tableId"])])])),_:1}),v(se,{scroll:{x:1800},size:"small",loading:R.value,bordered:"",dataSource:M.value,columns:N.value,rowKey:"jobId",pagination:!1},{bodyCell:h((({record:e,column:t})=>["jobClass"===t.dataIndex?(_(),I(ae,{key:0},{title:h((()=>[C(T(e.jobClass),1)])),default:h((()=>{return[C(" "+T((a=e.jobClass,a.split(".").pop())),1)];var a})),_:2},1024)):J("",!0),"triggerType"===t.dataIndex?(_(),j(x,{key:1},[e.triggerType===z(a).CRON.value?(_(),I(te,{key:0,color:"success"},{default:h((()=>[C(T(e.triggerTypeDesc),1)])),_:2},1024)):e.triggerType===z(a).FIXED_DELAY.value?(_(),I(te,{key:1,color:"processing"},{default:h((()=>[C(T(e.triggerTypeDesc),1)])),_:2},1024)):(_(),I(te,{key:2,color:"pink"},{default:h((()=>[C(T(e.triggerTypeDesc),1)])),_:2},1024))],64)):J("",!0),"lastJob"===t.dataIndex?(_(),j(x,{key:2},[e.lastJobLog?(_(),j("div",F,[v(ae,null,{title:h((()=>{return[C(T((a=e.lastJobLog.executeResult,a?a.substring(0,400)+(a.length>400?" ...":""):"")),1)];var a})),default:h((()=>[e.lastJobLog.successFlag?(_(),I(le,{key:0,style:{color:"#39c710"}})):(_(),I(oe,{key:1,style:{color:"#f50"}})),C(" "+T(e.lastJobLog.executeStartTime),1)])),_:2},1024)])):J("",!0)],64)):J("",!0),"nextJob"===t.dataIndex?(_(),j(x,{key:3},[e.enabledFlag&&e.nextJobExecuteTimeList?(_(),I(ae,{key:0},{title:h((()=>[L,(_(!0),j(x,null,w(e.nextJobExecuteTimeList,(e=>(_(),j("div",{key:e},T(e),1)))),128))])),default:h((()=>[C(" "+T(e.nextJobExecuteTimeList[0]),1)])),_:2},1024)):J("",!0)],64)):J("",!0),"enabledFlag"===t.dataIndex?(_(),I(ie,{key:4,checked:e.enabledFlag,"onUpdate:checked":a=>e.enabledFlag=a,"checked-children":"已启用","un-checked-children":"已禁用",onChange:a=>A(a,e),loading:e.enabledLoading},null,8,["checked","onUpdate:checked","onChange","loading"])):J("",!0),"action"===t.dataIndex?(_(),j("div",q,[S((_(),I(g,{onClick:a=>Q(e),type:"link"},{default:h((()=>[C("编辑")])),_:2},1032,["onClick"])),[[pe,"support:job:update"]]),S((_(),I(g,{type:"link",onClick:a=>function(e){B.value.openExecuteModal(e)}(e)},{default:h((()=>[C("执行")])),_:2},1032,["onClick"])),[[pe,"support:job:execute"]]),S((_(),I(g,{onClick:a=>{return t=e.jobId,l=e.jobName,void G.value.show(t,l);var t,l},type:"link"},{default:h((()=>[C("记录")])),_:2},1032,["onClick"])),[[pe,"support:job:log:query"]]),S((_(),I(g,{danger:"",onClick:a=>Y(e.jobId,e.jobName),type:"link"},{default:h((()=>[C("删除")])),_:2},1032,["onClick"])),[[pe,"support:job:log:delete"]])])):J("",!0)])),_:1},8,["loading","dataSource","columns"]),k("div",O,[v(re,{showSizeChanger:"",showQuickJumper:"","show-less-items":"",pageSizeOptions:z(t),defaultPageSize:P.pageSize,current:P.pageNum,"onUpdate:current":l[5]||(l[5]=e=>P.pageNum=e),pageSize:P.pageSize,"onUpdate:pageSize":l[6]||(l[6]=e=>P.pageSize=e),total:W.value,onChange:$,onShowSizeChange:$,"show-total":e=>`共${e}条`},null,8,["pageSizeOptions","defaultPageSize","current","pageSize","total","show-total"])])])),_:1}),v(ne,{key:"2",tab:"已删除任务"},{default:h((()=>[v(r)])),_:1})])),_:1},8,["activeKey"])])),_:1}),v(n,{ref_key:"jobFormModal",ref:B,onReloadList:$},null,512),v(d,{ref_key:"jobLogModal",ref:G},null,512)])}}});export{U as default};
