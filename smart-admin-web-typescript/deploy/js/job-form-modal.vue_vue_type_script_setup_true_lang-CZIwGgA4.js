import{j as e}from"./job-api-D-3ZlMQ3.js";import{T as a,S as l,s as o}from"./index-CBkxY9s9.js";import{b as t}from"./ant-design-vue-CcohkicM.js";import{d as u,r as n,a as r,b2 as s,b as i,o as d,c as m,bz as p,u as c,J as b,ag as v,ah as g,ai as f}from"./@vue-BVvo-xZd.js";const h=f("br",null,null,-1),j=f("br",null,null,-1),x=u({__name:"job-form-modal",emits:["reloadList"],setup(u,{expose:f,emit:x}){const y=x,w=n(!1),_=n(!1),C=n(),R={jobId:null,jobName:"",jobClass:"",triggerType:a.CRON.value,triggerValue:null,cron:"",fixedDelay:null,param:"",enabledFlag:!1,remark:"",sort:null};let N=r({...R});const k={jobName:[{required:!0,message:"请输入任务名称"}],jobClass:[{required:!0,message:"请输入执行类"}],triggerType:[{required:!0,message:"请选择触发类型"}],sort:[{required:!0,message:"请输入排序"}]};function T(){Object.assign(N,R),_.value=!1}async function D(){C.value.validate().then((async()=>{if(a.CRON.value===N.triggerType&&(N.triggerValue=N.cron),a.FIXED_DELAY.value===N.triggerType&&(N.triggerValue=N.fixedDelay),N.triggerValue)try{l.show(),w.value?(await e.addJob(N),t.success("添加成功")):(await e.updateJob(N),t.success("更新成功")),T(),y("reloadList")}catch(u){o.captureError(u)}finally{l.hide()}else t.error("请填写 触发时间")})).catch((e=>{t.error("参数验证错误，请检查表单数据")}))}const U=n(!1),O={jobId:null,jobName:"",jobClass:"",param:null};let E=r({...O});function F(){Object.assign(E,O),U.value=!1}async function I(){try{let a={jobId:E.jobId,param:E.param};await e.executeJob(a),l.show(),await new Promise((e=>setTimeout(e,2e3))),t.success("执行成功"),F(),y("reloadList")}catch(a){o.captureError(a)}finally{l.hide()}}return f({openUpdateModal:function(e){w.value=null==e,w.value||(Object.assign(N,e),a.CRON.value===e.triggerType&&(N.cron=e.triggerValue),a.FIXED_DELAY.value===e.triggerType&&(N.fixedDelay=e.triggerValue)),_.value=!0},openExecuteModal:function(e){Object.assign(E,e),U.value=!0}}),(e,l)=>{const o=s("a-input"),t=s("a-form-item"),u=s("a-textarea"),n=s("a-input-number"),r=s("a-radio-button"),f=s("a-radio-group"),x=s("a-switch"),y=s("a-form"),R=s("a-modal"),O=s("a-alert");return d(),i("div",null,[m(R,{open:_.value,width:650,title:w.value?"添加":"编辑","ok-text":"确认","cancel-text":"取消",onCancel:T,onOk:D},{default:p((()=>[m(y,{ref_key:"updateFormRef",ref:C,model:c(N),rules:k,"label-col":{span:4}},{default:p((()=>[m(t,{label:"任务名称",name:"jobName"},{default:p((()=>[m(o,{placeholder:"请输入任务名称",value:c(N).jobName,"onUpdate:value":l[0]||(l[0]=e=>c(N).jobName=e),maxlength:100,showCount:!0},null,8,["value"])])),_:1}),m(t,{label:"任务描述",name:"remark"},{default:p((()=>[m(u,{"auto-size":{minRows:2,maxRows:4},value:c(N).remark,"onUpdate:value":l[1]||(l[1]=e=>c(N).remark=e),placeholder:"(可选)请输入任务备注描述",maxlength:250,showCount:!0},null,8,["value"])])),_:1}),m(t,{label:"排序",name:"sort"},{default:p((()=>[m(n,{value:c(N).sort,"onUpdate:value":l[2]||(l[2]=e=>c(N).sort=e),min:-99999999,max:99999999,precision:0,style:{width:"100%"},placeholder:"值越小越靠前"},null,8,["value"])])),_:1}),m(t,{label:"执行类",name:"jobClass"},{default:p((()=>[m(u,{"auto-size":{minRows:2,maxRows:4},value:c(N).jobClass,"onUpdate:value":l[3]||(l[3]=e=>c(N).jobClass=e),placeholder:"示例：net.lab1024.sa.base.module.support.job.sample.SmartJobSample1",maxlength:200,showCount:!0},null,8,["value"])])),_:1}),m(t,{label:"任务参数",name:"param"},{default:p((()=>[m(u,{"auto-size":{minRows:3,maxRows:6},value:c(N).param,"onUpdate:value":l[4]||(l[4]=e=>c(N).param=e),placeholder:"(可选)请输入任务执行参数",maxlength:1e3,showCount:!0},null,8,["value"])])),_:1}),m(t,{label:"触发类型",name:"triggerType"},{default:p((()=>[m(f,{value:c(N).triggerType,"onUpdate:value":l[5]||(l[5]=e=>c(N).triggerType=e)},{default:p((()=>[m(r,{value:c(a).CRON.value},{default:p((()=>[b("CRON表达式")])),_:1},8,["value"]),m(r,{value:c(a).FIXED_DELAY.value},{default:p((()=>[b("固定间隔")])),_:1},8,["value"])])),_:1},8,["value"])])),_:1}),m(t,{label:"触发时间",name:"triggerTime"},{default:p((()=>[c(N).triggerType===c(a).CRON.value?(d(),v(o,{key:0,placeholder:"示例：10 15 0/1 * * *",value:c(N).cron,"onUpdate:value":l[6]||(l[6]=e=>c(N).cron=e),maxlength:100,showCount:!0},null,8,["value"])):c(N).triggerType===c(a).FIXED_DELAY.value?(d(),v(n,{key:1,value:c(N).fixedDelay,"onUpdate:value":l[7]||(l[7]=e=>c(N).fixedDelay=e),min:1,max:1e8,precision:0},{addonBefore:p((()=>[b("每隔")])),addonAfter:p((()=>[b("秒")])),_:1},8,["value"])):g("",!0)])),_:1}),m(t,{label:"是否开启",name:"enabledFlag"},{default:p((()=>[m(x,{checked:c(N).enabledFlag,"onUpdate:checked":l[8]||(l[8]=e=>c(N).enabledFlag=e)},null,8,["checked"])])),_:1})])),_:1},8,["model"])])),_:1},8,["open","title"]),m(R,{open:U.value,width:650,title:"执行任务","ok-text":"执行","cancel-text":"取消",onCancel:F,onOk:I},{default:p((()=>[h,m(O,{type:"info","show-icon":"",style:{"margin-left":"25px"}},{message:p((()=>[b(" 点击【执行】后会按照【任务参数】，无论任务是否开启，都会立即执行。 ")])),_:1}),j,m(y,{"label-col":{span:4}},{default:p((()=>[m(t,{label:"任务名称",name:"jobName"},{default:p((()=>[m(o,{value:c(E).jobName,"onUpdate:value":l[9]||(l[9]=e=>c(E).jobName=e),disabled:!0},null,8,["value"])])),_:1}),m(t,{label:"任务类名",name:"jobClass"},{default:p((()=>[m(u,{"auto-size":{minRows:2,maxRows:4},value:c(E).jobClass,"onUpdate:value":l[10]||(l[10]=e=>c(E).jobClass=e),disabled:!0},null,8,["value"])])),_:1}),m(t,{label:"任务参数",name:"param"},{default:p((()=>[m(u,{"auto-size":{minRows:3,maxRows:6},value:c(E).param,"onUpdate:value":l[11]||(l[11]=e=>c(E).param=e),placeholder:"(可选)请输入任务执行参数",maxlength:1e3,showCount:!0},null,8,["value"])])),_:1})])),_:1})])),_:1},8,["open"])])}}});export{x as _};
