import{_ as e}from"./lodash-2VbGH-WW.js";import{r as a}from"./role-api-CQ_zWWSq.js";import{c as t,s as o,d as l,P as s,S as i,a as r}from"./index-CBkxY9s9.js";import{_ as n}from"./index.vue_vue_type_script_setup_true_lang-BqAwz9eM.js";import{b as p,M as d}from"./ant-design-vue-CcohkicM.js";import{d as u,i as c,w as m,e as y,a as g,r as v,m as j,b2 as f,z as h,b as w,o as b,ai as k,c as _,J as x,ag as I,ah as z,u as S,bz as E,y as C,be as N}from"./@vue-BVvo-xZd.js";import"./@ant-design-D2dl84QQ.js";import"./vue-Bbq_A2bw.js";import"./@ctrl-DlzbjsCp.js";import"./vue3-json-viewer-DGFKKWPN.js";import"./dayjs-B6vKC6dp.js";import"./vue-i18n-CEbWPeBD.js";import"./@intlify-D18cTrFw.js";import"./pinia-CgN6MZDh.js";import"./axios-BlN9Xwzv.js";import"./crypto-js-TV0Ce7JK.js";import"./sm-crypto-CWaozmhJ.js";import"./jsbn-DBh4-X7k.js";import"./nprogress-CqoNXQnd.js";import"./vue-router-D-yLC68c.js";import"./mitt-CNZ6avp8.js";import"./@babel-rSvM8Ko2.js";import"./resize-observer-polyfill-OVnto9HH.js";import"./@emotion-DXlYAqfy.js";import"./stylis-YutRQeBK.js";import"./vue-types-Sy1fKJ9U.js";import"./dom-align-CCb293uS.js";import"./lodash-es-BgZ_dRTG.js";import"./async-validator-BTKOuuO-.js";import"./throttle-debounce-w9OM8Bxz.js";import"./index.vue_vue_type_script_setup_true_lang-Ca0kUvG5.js";import"./department-api-Dth9G_6l.js";const R={class:"header"},T={key:1},D=["onClick"],M={class:"smart-query-table-page"},O=r(u({__name:"index",setup(r){let u=c("selectRoleId");m((()=>u.value),(()=>G())),y(G);const O=g({...{pageNum:1,pageSize:t,roleId:void 0,keywords:void 0}}),P=v(0),U=v([]),q=v(!1);function A(){O.keywords="",G()}function F(){O.pageNum=1,G()}async function G(){try{q.value=!0,O.roleId=u.value;let e=await a.queryRoleEmployee(O);U.value=e.data.list,P.value=e.data.total}catch(e){o.captureError(e)}finally{q.value=!1}}const J=g([{title:"姓名",dataIndex:"actualName"},{title:"手机号",dataIndex:"phone"},{title:"登录账号",dataIndex:"loginName"},{title:"部门",dataIndex:"departmentName"},{title:"状态",dataIndex:"disabledFlag"},{title:"操作",dataIndex:"operate",width:60}]),K=v();async function L(){let e=(await a.getRoleAllEmployee(u.value)).data.map((e=>e.employeeId))||[];K.value.showModal(e)}async function B(t){if(e.isEmpty(t))p.warning("请选择角色人员");else{i.show();try{let e={employeeIdList:t,roleId:u.value};await a.batchAddRoleEmployee(e),p.success("添加成功"),await G()}catch(l){o.captureError(l)}finally{i.hide()}}}const Q=v([]),V=j((()=>Q.value.length>0));function W(e){Q.value=e}function X(){V.value?d.confirm({title:"提示",content:"确定移除这些角色成员吗？",okText:"确定",okType:"danger",async onOk(){i.show();try{let e={employeeIdList:Q.value,roleId:u.value};await a.batchRemoveRoleEmployee(e),p.success("移除成功"),Q.value=[],await G()}catch(e){o.captureError(e)}finally{i.hide()}},cancelText:"取消",onCancel(){}}):p.warning("请选择要删除的角色成员")}return(e,t)=>{const r=f("a-input"),c=f("a-button"),m=f("a-tag"),y=f("a-table"),g=f("a-pagination"),v=h("privilege");return b(),w("div",null,[k("div",R,[k("div",null,[x(" 关键字： "),_(r,{style:{width:"250px"},value:O.keywords,"onUpdate:value":t[0]||(t[0]=e=>O.keywords=e),placeholder:"姓名/手机号/登录账号"},null,8,["value"]),S(u)?(b(),I(c,{key:0,class:"button-style",type:"primary",onClick:F},{default:E((()=>[x("搜索")])),_:1})):z("",!0),S(u)?(b(),I(c,{key:1,class:"button-style",type:"default",onClick:A},{default:E((()=>[x("重置")])),_:1})):z("",!0)]),k("div",null,[S(u)?C((b(),I(c,{key:0,class:"button-style",type:"primary",onClick:L},{default:E((()=>[x("添加员工")])),_:1})),[[v,"system:role:employee:add"]]):z("",!0),S(u)?C((b(),I(c,{key:1,class:"button-style",type:"primary",danger:"",onClick:X},{default:E((()=>[x("批量移除")])),_:1})),[[v,"system:role:employee:batch:delete"]]):z("",!0)])]),_(y,{loading:q.value,dataSource:U.value,columns:J,pagination:!1,scroll:{y:400},rowKey:"employeeId","row-selection":{selectedRowKeys:Q.value,onChange:W},size:"small",bordered:""},{bodyCell:E((({text:t,record:l,column:s})=>["disabledFlag"===s.dataIndex?(b(),I(m,{key:0,color:t?"error":"processing"},{default:E((()=>[x(N(t?"禁用":"启用"),1)])),_:2},1032,["color"])):"gender"===s.dataIndex?(b(),w("span",T,N(e.$smartEnumPlugin.getDescByValue("GENDER_ENUM",t)),1)):z("",!0),"operate"===s.dataIndex?C((b(),w("a",{key:2,onClick:e=>async function(e){d.confirm({title:"提示",content:"确定要删除该角色成员么？",okText:"确定",okType:"danger",async onOk(){i.show();try{await a.deleteEmployeeRole(e,u.value),p.success("移除成功"),await G()}catch(t){o.captureError(t)}finally{i.hide()}},cancelText:"取消",onCancel(){}})}(l.employeeId)},[x("移除")],8,D)),[[v,"system:role:employee:delete"]]):z("",!0)])),_:1},8,["loading","dataSource","columns","row-selection"]),k("div",M,[_(g,{showSizeChanger:"",showQuickJumper:"","show-less-items":"",pageSizeOptions:S(s),defaultPageSize:O.pageSize,current:O.pageNum,"onUpdate:current":t[1]||(t[1]=e=>O.pageNum=e),pageSize:O.pageSize,"onUpdate:pageSize":t[2]||(t[2]=e=>O.pageSize=e),total:P.value,onChange:G,onShowSizeChange:G,"show-total":S(l)},null,8,["pageSizeOptions","defaultPageSize","current","pageSize","total","show-total"])]),_(n,{ref_key:"selectEmployeeModal",ref:K,onSelectData:B},null,512)])}}}),[["__scopeId","data-v-05946c56"]]);export{O as default};
