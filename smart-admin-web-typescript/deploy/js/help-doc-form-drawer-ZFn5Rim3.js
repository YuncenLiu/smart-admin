import{_ as e}from"./lodash-2VbGH-WW.js";import{M as t,U as a,F as l,S as o,v as r,s,a as i}from"./index-CBkxY9s9.js";import{W as n}from"./index-DwfIiKZa.js";import{_ as u}from"./help-doc-catalog-tree-select.vue_vue_type_script_setup_true_lang-BLyeRJ10.js";import{m as d}from"./menu-api-59Sr21sk.js";import{b as m}from"./menu-data-handler-CNHihdmH.js";import{d as p,r as c,e as v,b2 as f,ag as h,o as y,u as j,a as g,bz as _,c as b,ah as I,J as w,n as L}from"./@vue-BVvo-xZd.js";import{b as x}from"./ant-design-vue-CcohkicM.js";import"./@ant-design-D2dl84QQ.js";import"./vue-Bbq_A2bw.js";import"./@ctrl-DlzbjsCp.js";import"./vue3-json-viewer-DGFKKWPN.js";import"./dayjs-B6vKC6dp.js";import"./vue-i18n-CEbWPeBD.js";import"./@intlify-D18cTrFw.js";import"./pinia-CgN6MZDh.js";import"./axios-BlN9Xwzv.js";import"./crypto-js-TV0Ce7JK.js";import"./sm-crypto-CWaozmhJ.js";import"./jsbn-DBh4-X7k.js";import"./nprogress-CqoNXQnd.js";import"./vue-router-D-yLC68c.js";import"./mitt-CNZ6avp8.js";import"./@babel-rSvM8Ko2.js";import"./resize-observer-polyfill-OVnto9HH.js";import"./@emotion-DXlYAqfy.js";import"./stylis-YutRQeBK.js";import"./vue-types-Sy1fKJ9U.js";import"./dom-align-CCb293uS.js";import"./lodash-es-BgZ_dRTG.js";import"./async-validator-BTKOuuO-.js";import"./throttle-debounce-w9OM8Bxz.js";import"./@wangeditor-next-CoIDXbIU.js";const C=p({__name:"index",props:{value:Array,multiple:{type:Boolean,default:!1}},emits:["update:value"],setup(a,{expose:l,emit:o}){const r=a,s=o;let i=c([]);v(u);let n=[];async function u(){let e=await d.queryMenu();n=e.data.filter((e=>e.menuType===t.MENU.value||e.menuType===t.CATALOG.value));for(const a of n)a.menuType===t.CATALOG.value&&(a.disabled=!0);i.value=m(n)}function p(e){s("update:value",e)}return l({queryMenuTree:u,getMenuListByIdList:function(t){return e.cloneDeep(n.filter((e=>t.indexOf(e.menuId)>-1)))}}),(e,t)=>{const a=f("a-tree-select");return y(),h(a,{value:r.value,treeData:j(i),fieldNames:{label:"menuName",key:"menuId",value:"menuId"},"show-search":"","tree-checkable":"",style:{width:"100%"},"dropdown-style":{maxHeight:"400px",overflow:"auto"},placeholder:"请选择菜单","allow-clear":"","tree-default-expand-all":"",onChange:p},null,8,["value","treeData"])}}}),D=i(p({__name:"help-doc-form-drawer",emits:["reloadList"],setup(t,{expose:i,emit:d}){const m=d,p=c(!1);function v(){p.value=!1}const D=c(),T=c(),k=c(!1),U={helpDocId:void 0,helpDocCatalogId:void 0,title:void 0,author:void 0,sort:0,attachment:[],relationIdList:[],contentHtml:"",contentText:""},H=g({...U}),M={title:[{required:!0,message:"请输入"}],helpDocCatalogId:[{required:!0,message:"请选择目录"}],author:[{required:!0,message:"请输入作者"}],sort:[{required:!0,message:"请输入排序"}],contentHtml:[{required:!0,message:"请输入内容"}]};async function O(){try{H.contentHtml=T.value.getHtml(),H.contentText=T.value.getText(),await D.value.validateFields(),await async function(){try{o.show();let t=e.cloneDeep(H);if(k.value)t.relationList=[{relationName:"首页",relationId:0}];else{let e=q.value.getMenuListByIdList(H.relationIdList);t.relationList=e.map((e=>Object.assign({},{relationId:e.menuId,relationName:e.menuName})))}t.helpDocId?await r.update(t):await r.add(t),x.success("保存成功"),m("reloadList"),v()}catch(t){s.captureError(t)}finally{o.hide()}}()}catch(t){x.error("参数验证错误，请仔细填写表单数据!")}}const q=c();const E=c([]);function A(t){E.value=t,H.attachment=e.isEmpty(t)?[]:t}return i({showModal:function(t){Object.assign(H,U),E.value=[],t&&async function(t){try{o.show();const a=await r.getDetail(t),l=a.data.attachment;e.isEmpty(l)?E.value=[]:E.value=l,Object.assign(H,a.data),H.relationIdList=a.data.relationList?a.data.relationList.map((e=>e.relationId)):[],1===H.relationIdList.length&&0===H.relationIdList[0].relationId?k.value=!0:k.value=!1}catch(a){s.captureError(a)}finally{o.hide()}}(t),p.value=!0,L((()=>{D.value.clearValidate()}))}}),(e,t)=>{const o=f("a-input"),r=f("a-form-item"),s=f("a-input-number"),i=f("a-radio-button"),d=f("a-radio-group"),m=f("a-form"),c=f("a-button"),g=f("a-space"),L=f("a-drawer");return y(),h(L,{title:H.helpDocId?"编辑系统手册":"新建系统手册",open:p.value,width:1e3,footerStyle:{textAlign:"right"},onClose:v,destroyOnClose:!0},{footer:_((()=>[b(g,null,{default:_((()=>[b(c,{onClick:v},{default:_((()=>[w("取消")])),_:1}),b(c,{type:"primary",onClick:O},{default:_((()=>[w("保存")])),_:1})])),_:1})])),default:_((()=>[b(m,{ref_key:"formRef",ref:D,model:H,rules:M,"label-col":{span:3},"wrapper-col":{span:20}},{default:_((()=>[b(r,{label:"标题",name:"title"},{default:_((()=>[b(o,{value:H.title,"onUpdate:value":t[0]||(t[0]=e=>H.title=e),placeholder:"请输入标题"},null,8,["value"])])),_:1}),b(r,{label:"目录",name:"helpDocCatalogId"},{default:_((()=>[b(u,{value:H.helpDocCatalogId,"onUpdate:value":t[1]||(t[1]=e=>H.helpDocCatalogId=e),style:{width:"100%"}},null,8,["value"])])),_:1}),b(r,{label:"作者",name:"author"},{default:_((()=>[b(o,{value:H.author,"onUpdate:value":t[2]||(t[2]=e=>H.author=e),placeholder:"请输入作者"},null,8,["value"])])),_:1}),b(r,{label:"排序",name:"sort"},{default:_((()=>[b(s,{value:H.sort,"onUpdate:value":t[3]||(t[3]=e=>H.sort=e),placeholder:"值越小越靠前"},null,8,["value"]),w("（值越小越靠前） ")])),_:1}),b(r,{label:"是否首页显示"},{default:_((()=>[b(d,{value:k.value,"onUpdate:value":t[4]||(t[4]=e=>k.value=e),"button-style":"solid"},{default:_((()=>[b(i,{value:!0},{default:_((()=>[w("首页显示")])),_:1}),b(i,{value:!1},{default:_((()=>[w("首页不用显示")])),_:1})])),_:1},8,["value"])])),_:1}),k.value?I("",!0):(y(),h(r,{key:0,label:"关联菜单"},{default:_((()=>[b(C,{value:H.relationIdList,"onUpdate:value":t[5]||(t[5]=e=>H.relationIdList=e),ref_key:"menuTreeSelect",ref:q},null,8,["value"])])),_:1})),b(r,{label:"公告内容",name:"contentHtml"},{default:_((()=>[b(n,{ref_key:"contentRef",ref:T,modelValue:H.contentHtml,height:300},null,8,["modelValue"])])),_:1}),b(r,{label:"附件"},{default:_((()=>[b(a,{defaultFileList:E.value,maxUploadSize:10,folder:j(l).HELP_DOC.value,buttonText:"上传附件",listType:"text",extraMsg:"最多上传10个附件",onChange:A},null,8,["defaultFileList","folder"])])),_:1})])),_:1},8,["model"])])),_:1},8,["title","open"])}}}),[["__scopeId","data-v-c533b3c1"]]);export{D as default};
