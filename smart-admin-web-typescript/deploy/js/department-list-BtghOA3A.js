import{d as e}from"./department-api-Dth9G_6l.js";import{_ as t}from"./lodash-2VbGH-WW.js";import{s as a,S as r}from"./index-CBkxY9s9.js";import{_ as l}from"./department-form-modal.vue_vue_type_script_setup_true_lang-BaekO3_q.js";import{M as n}from"./ant-design-vue-CcohkicM.js";import{E as o}from"./@ant-design-D2dl84QQ.js";import{d as s,r as i,a as d,e as u,b2 as m,z as p,b as c,o as f,c as v,bz as y,y as j,ag as _,J as h,ah as g,F as I}from"./@vue-BVvo-xZd.js";import"./vue3-json-viewer-DGFKKWPN.js";import"./dayjs-B6vKC6dp.js";import"./vue-i18n-CEbWPeBD.js";import"./@intlify-D18cTrFw.js";import"./vue-Bbq_A2bw.js";import"./pinia-CgN6MZDh.js";import"./axios-BlN9Xwzv.js";import"./crypto-js-TV0Ce7JK.js";import"./sm-crypto-CWaozmhJ.js";import"./jsbn-DBh4-X7k.js";import"./nprogress-CqoNXQnd.js";import"./vue-router-D-yLC68c.js";import"./mitt-CNZ6avp8.js";import"./@babel-rSvM8Ko2.js";import"./@ctrl-DlzbjsCp.js";import"./resize-observer-polyfill-OVnto9HH.js";import"./@emotion-DXlYAqfy.js";import"./stylis-YutRQeBK.js";import"./vue-types-Sy1fKJ9U.js";import"./dom-align-CCb293uS.js";import"./lodash-es-BgZ_dRTG.js";import"./async-validator-BTKOuuO-.js";import"./throttle-debounce-w9OM8Bxz.js";import"./index.vue_vue_type_script_setup_true_lang-Ca0kUvG5.js";import"./index.vue_vue_type_script_setup_true_lang-CcaTzEf2.js";const k={key:0,class:"smart-table-operate"},w=s({__name:"department-list",setup(s){const w=i(""),x=i(!1),b=i(),E=i([]),C=i([]),q=i(new Map),z=d([]),M=i([{title:"部门名称",dataIndex:"name",key:"name"},{title:"负责人",dataIndex:"managerName",key:"managerName",width:100},{title:"排序",dataIndex:"sort",key:"sort",width:100},{title:"创建时间",dataIndex:"createTime",width:150},{title:"更新时间",dataIndex:"updateTime",width:150},{title:"操作",dataIndex:"action",fixed:"right",width:200}]);async function O(){try{x.value=!0;let a=(await e.queryAllDepartment()).data;a.forEach((e=>{q.value.set(e.departmentId,e)})),E.value=a,C.value=R(a,0),!t.isEmpty(C.value)&&C.value.length>0&&(b.value=C.value[0].departmentId),z.value=[],z.push(b.value)}catch(r){a.captureError(r)}finally{x.value=!1}}function R(e,a){let r=e.filter((e=>e.parentId===a))||[];return t.isEmpty(r)?null:(r.forEach((t=>{t.children=R(e,t.departmentId)})),r)}function T(){w.value="",D()}function D(){if(!w.value)return void(C.value=R(E.value,0));let e=E.value.concat();if(!e)return;let t=e.filter((e=>e.name.indexOf(w.value)>-1)),a=[];t.forEach((e=>{K(a,e.departmentId)})),C.value=R(a,0)}function K(e,t,a){let r=q.value.get(t);r&&!e.some((e=>e.departmentId===t))&&(e.push(r),r.parentId&&0!==r.parentId&&K(e,r.parentId))}u((()=>{O()}));const A=i();function F(e){let t={departmentId:0,name:"",parentId:e.departmentId||null};A.value.showModal(t)}return(t,s)=>{const i=m("a-input"),d=m("a-form-item"),u=m("SearchOutlined"),E=m("a-button"),q=m("ReloadOutlined"),R=m("a-button-group"),K=m("PlusOutlined"),N=m("a-row"),S=m("a-form"),J=m("a-table"),P=m("a-card"),U=p("privilege");return f(),c(I,null,[v(S,{class:"smart-query-form"},{default:y((()=>[v(N,{class:"smart-query-form-row"},{default:y((()=>[v(d,{label:"部门名称",class:"smart-query-form-item"},{default:y((()=>[v(i,{style:{width:"300px"},value:w.value,"onUpdate:value":s[0]||(s[0]=e=>w.value=e),placeholder:"请输入部门名称"},null,8,["value"])])),_:1}),v(d,{class:"smart-query-form-item smart-margin-left10"},{default:y((()=>[v(R,null,{default:y((()=>[j((f(),_(E,{type:"primary",onClick:D},{icon:y((()=>[v(u)])),default:y((()=>[h(" 查询 ")])),_:1})),[[U,"support:department:query"]]),j((f(),_(E,{onClick:T},{icon:y((()=>[v(q)])),default:y((()=>[h(" 重置 ")])),_:1})),[[U,"support:department:query"]])])),_:1}),j((f(),_(E,{type:"primary",onClick:F,class:"smart-margin-left20"},{icon:y((()=>[v(K)])),default:y((()=>[h(" 新建 ")])),_:1})),[[U,"system:department:add"]])])),_:1})])),_:1})])),_:1}),v(P,{size:"small",bordered:!0},{default:y((()=>[v(J,{size:"small",bordered:"",loading:x.value,rowKey:"departmentId",columns:M.value,"data-source":C.value,defaultExpandAllRows:!1,defaultExpandedRowKeys:z,pagination:!1},{bodyCell:y((({record:t,column:l})=>["action"===l.dataIndex?(f(),c("div",k,[j((f(),_(E,{onClick:e=>F(t),type:"link"},{default:y((()=>[h("添加下级")])),_:2},1032,["onClick"])),[[U,"system:department:add"]]),j((f(),_(E,{onClick:e=>{return a=t,void A.value.showModal(a);var a},type:"link"},{default:y((()=>[h("编辑")])),_:2},1032,["onClick"])),[[U,"system:department:update"]]),t.departmentId!==b.value?j((f(),_(E,{key:0,danger:"",onClick:l=>{return s=t.departmentId,void n.confirm({title:"提醒",icon:v(o),content:"确定要删除该部门吗?",okText:"删除",okType:"danger",async onOk(){r.show();try{await e.deleteDepartment(s),await O()}catch(t){a.captureError(t)}finally{r.hide()}},cancelText:"取消",onCancel(){}});var s},type:"link"},{default:y((()=>[h("删除")])),_:2},1032,["onClick"])),[[U,"system:department:delete"]]):g("",!0)])):g("",!0)])),_:1},8,["loading","columns","data-source","defaultExpandedRowKeys"]),v(l,{ref_key:"departmentFormModal",ref:A,onRefresh:O},null,512)])),_:1})],64)}}});export{w as default};
