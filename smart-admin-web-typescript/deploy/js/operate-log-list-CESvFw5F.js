import{O as e,o as a}from"./operate-log-detail-modal-SSBkO98b.js";import{P as t,s}from"./index-CBkxY9s9.js";import{d as l}from"./default-time-ranges-JqpEQ5s5.js";import{u as o}from"./ua-parser-js-DNXwZhEt.js";import{_ as r}from"./index.vue_vue_type_script_setup_true_lang-CtW6JKpO.js";import{T as i}from"./table-id-const-DES3cCFe.js";import{d as u,r as d,a as n,e as p,b2 as m,z as c,b as v,o as g,y as f,c as y,ag as j,bz as h,u as b,J as _,ai as w,ah as x,be as I,F as z}from"./@vue-BVvo-xZd.js";import"./vue3-json-viewer-DGFKKWPN.js";import"./ant-design-vue-CcohkicM.js";import"./@babel-rSvM8Ko2.js";import"./@ant-design-D2dl84QQ.js";import"./vue-Bbq_A2bw.js";import"./@ctrl-DlzbjsCp.js";import"./resize-observer-polyfill-OVnto9HH.js";import"./@emotion-DXlYAqfy.js";import"./stylis-YutRQeBK.js";import"./vue-types-Sy1fKJ9U.js";import"./dom-align-CCb293uS.js";import"./lodash-es-BgZ_dRTG.js";import"./dayjs-B6vKC6dp.js";import"./async-validator-BTKOuuO-.js";import"./throttle-debounce-w9OM8Bxz.js";import"./lodash-2VbGH-WW.js";import"./vue-i18n-CEbWPeBD.js";import"./@intlify-D18cTrFw.js";import"./pinia-CgN6MZDh.js";import"./axios-BlN9Xwzv.js";import"./crypto-js-TV0Ce7JK.js";import"./sm-crypto-CWaozmhJ.js";import"./jsbn-DBh4-X7k.js";import"./nprogress-CqoNXQnd.js";import"./vue-router-D-yLC68c.js";import"./mitt-CNZ6avp8.js";import"./sortablejs-CRp0PNdb.js";const S={key:1},k={key:2},q={key:3,class:"smart-table-operate"},U={class:"smart-query-table-page"},C=u({__name:"operate-log-list",setup(u){const C=d([{title:"用户",dataIndex:"operateUserName",width:70},{title:"类型",dataIndex:"operateUserType",width:50,ellipsis:!0},{title:"操作模块",dataIndex:"module",ellipsis:!0},{title:"操作内容",dataIndex:"content",ellipsis:!0},{title:"请求路径",dataIndex:"url",ellipsis:!0},{title:"IP",dataIndex:"ip",ellipsis:!0},{title:"IP地区",dataIndex:"ipRegion",ellipsis:!0},{title:"客户端",dataIndex:"userAgent",ellipsis:!0},{title:"请求方法",dataIndex:"method",ellipsis:!0},{title:"请求结果",dataIndex:"successFlag",width:80},{title:"时间",dataIndex:"createTime",width:150},{title:"操作",dataIndex:"action",fixed:"right",width:60}]),N={userName:"",requestKeywords:"",keywords:"",successFlag:void 0,startDate:void 0,endDate:void 0,pageNum:1,pageSize:10},O=n({...N}),P=d([]),F=l;function D(e,a){O.startDate=a[0],O.endDate=a[1]}const E=d(!1),T=d([]),A=d(0);function L(){Object.assign(O,N),P.value=[],R()}function K(){O.pageNum=1,R()}async function R(){try{E.value=!0;let e=await a.queryList(O);for(const a of e.data.list){if(!a.userAgent)continue;let e=o(a.userAgent);a.browser=e.browser.name,a.os=e.os.name,a.device=e.device.vendor?e.device.vendor+e.device.model:""}const t=e.data.list;A.value=e.data.total,T.value=t}catch(e){s.captureError(e)}finally{E.value=!1}}p(R);const V=d();return(a,s)=>{const l=m("a-input"),o=m("a-form-item"),u=m("a-range-picker"),d=m("a-radio-button"),n=m("a-radio-group"),p=m("SearchOutlined"),N=m("a-button"),B=m("ReloadOutlined"),J=m("a-button-group"),M=m("a-row"),$=m("a-form"),G=m("a-tag"),Q=m("a-table"),Y=m("a-pagination"),H=m("a-card"),W=c("privilege");return g(),v(z,null,[f((g(),j($,{class:"smart-query-form"},{default:h((()=>[y(M,{class:"smart-query-form-row"},{default:h((()=>[y(o,{label:"操作关键字",class:"smart-query-form-item"},{default:h((()=>[y(l,{style:{width:"150px"},value:O.keywords,"onUpdate:value":s[0]||(s[0]=e=>O.keywords=e),placeholder:"模块/操作内容"},null,8,["value"])])),_:1}),y(o,{label:"请求关键字",class:"smart-query-form-item"},{default:h((()=>[y(l,{style:{width:"220px"},value:O.requestKeywords,"onUpdate:value":s[1]||(s[1]=e=>O.requestKeywords=e),placeholder:"请求地址/请求方法/请求参数"},null,8,["value"])])),_:1}),y(o,{label:"用户名称",class:"smart-query-form-item"},{default:h((()=>[y(l,{style:{width:"100px"},value:O.userName,"onUpdate:value":s[2]||(s[2]=e=>O.userName=e),placeholder:"用户名称"},null,8,["value"])])),_:1}),y(o,{label:"请求时间",class:"smart-query-form-item"},{default:h((()=>[y(u,{onChange:D,value:P.value,"onUpdate:value":s[3]||(s[3]=e=>P.value=e),presets:b(F),style:{width:"240px"}},null,8,["value","presets"])])),_:1}),y(o,{label:"快速筛选",class:"smart-query-form-item"},{default:h((()=>[y(n,{value:O.successFlag,"onUpdate:value":s[4]||(s[4]=e=>O.successFlag=e),onChange:K},{default:h((()=>[y(d,{value:void 0},{default:h((()=>[_("全部")])),_:1}),y(d,{value:!0},{default:h((()=>[_("成功")])),_:1}),y(d,{value:!1},{default:h((()=>[_("失败")])),_:1})])),_:1},8,["value"])])),_:1}),y(o,{class:"smart-query-form-item smart-margin-left10"},{default:h((()=>[y(J,null,{default:h((()=>[y(N,{type:"primary",onClick:R},{icon:h((()=>[y(p)])),default:h((()=>[_(" 查询 ")])),_:1}),y(N,{onClick:L},{icon:h((()=>[y(B)])),default:h((()=>[_(" 重置 ")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})),[[W,"support:operateLog:query"]]),y(H,{size:"small",bordered:!1,hoverable:!0,style:{height:"100%"}},{default:h((()=>[y(M,{justify:"end"},{default:h((()=>[y(r,{class:"smart-margin-bottom5",modelValue:C.value,"onUpdate:modelValue":s[5]||(s[5]=e=>C.value=e),tableId:b(i).SUPPORT.CONFIG,refresh:R},null,8,["modelValue","tableId"])])),_:1}),y(Q,{size:"small",loading:E.value,dataSource:T.value,columns:C.value,bordered:"",rowKey:"operateLogId",pagination:!1},{bodyCell:h((({text:e,record:t,column:s})=>["successFlag"===s.dataIndex?(g(),j(G,{key:0,color:e?"success":"error"},{default:h((()=>[_(I(e?"成功":"失败"),1)])),_:2},1032,["color"])):x("",!0),"userAgent"===s.dataIndex?(g(),v("div",S,I(t.browser)+" / "+I(t.os)+" / "+I(t.device),1)):x("",!0),"operateUserType"===s.dataIndex?(g(),v("div",k,I(a.$smartEnumPlugin.getDescByValue("USER_TYPE_ENUM",e)),1)):"action"===s.dataIndex?(g(),v("div",q,[f((g(),j(N,{onClick:e=>{return a=t.operateLogId,void V.value.show(a);var a},type:"link"},{default:h((()=>[_("详情")])),_:2},1032,["onClick"])),[[W,"support:operateLog:detail"]])])):x("",!0)])),_:1},8,["loading","dataSource","columns"]),w("div",U,[y(Y,{showSizeChanger:"",showQuickJumper:"","show-less-items":"",pageSizeOptions:b(t),defaultPageSize:O.pageSize,current:O.pageNum,"onUpdate:current":s[6]||(s[6]=e=>O.pageNum=e),pageSize:O.pageSize,"onUpdate:pageSize":s[7]||(s[7]=e=>O.pageSize=e),total:A.value,onChange:R,onShowSizeChange:R,"show-total":e=>`共${e}条`},null,8,["pageSizeOptions","defaultPageSize","current","pageSize","total","show-total"])]),y(e,{ref_key:"detailModal",ref:V},null,512)])),_:1})],64)}}});export{C as default};
