import{r as e}from"./regular-const-vBMlR054.js";import{_ as a}from"./index.vue_vue_type_script_setup_true_lang-Ca0kUvG5.js";import{_ as t}from"./index.vue_vue_type_script_setup_true_lang-xi4AYrGW.js";import{_ as l}from"./index.vue_vue_type_script_setup_true_lang-D394UfoC.js";import{F as r,A as s,B as i,s as o,k as n,e as u,S as d,a as m}from"./index-CBkxY9s9.js";import{b as p}from"./ant-design-vue-CcohkicM.js";import{d as c,r as v,a as f,e as g,b2 as _,b as j,o as y,ai as h,c as b,bz as I,u as x,J as N,ag as k,aY as w,aW as U}from"./@vue-BVvo-xZd.js";import"./department-api-Dth9G_6l.js";import"./position-api-DKbDvSIj.js";import"./@ant-design-D2dl84QQ.js";import"./vue-Bbq_A2bw.js";import"./@ctrl-DlzbjsCp.js";import"./lodash-2VbGH-WW.js";import"./vue3-json-viewer-DGFKKWPN.js";import"./dayjs-B6vKC6dp.js";import"./vue-i18n-CEbWPeBD.js";import"./@intlify-D18cTrFw.js";import"./pinia-CgN6MZDh.js";import"./axios-BlN9Xwzv.js";import"./crypto-js-TV0Ce7JK.js";import"./sm-crypto-CWaozmhJ.js";import"./jsbn-DBh4-X7k.js";import"./nprogress-CqoNXQnd.js";import"./vue-router-D-yLC68c.js";import"./mitt-CNZ6avp8.js";import"./@babel-rSvM8Ko2.js";import"./resize-observer-polyfill-OVnto9HH.js";import"./@emotion-DXlYAqfy.js";import"./stylis-YutRQeBK.js";import"./vue-types-Sy1fKJ9U.js";import"./dom-align-CCb293uS.js";import"./lodash-es-BgZ_dRTG.js";import"./async-validator-BTKOuuO-.js";import"./throttle-debounce-w9OM8Bxz.js";const M=e=>(w("data-v-ea4f12a5"),e=e(),U(),e),E={class:"center-container"},F=M((()=>h("div",{class:"header-title"},"个人中心",-1))),q={class:"center-form-area"},z=M((()=>h("br",null,null,-1))),A={key:0,class:"avatar-container"},C=["src"],O=M((()=>h("div",{class:"overlay"},[h("span",null,"更新头像")],-1))),B={key:1},D=M((()=>h("div",{class:"ant-upload-text"},"上传头像",-1))),R=m(c({__name:"index",setup(m){const c=v();let w=f({employeeId:void 0,avatar:void 0,loginName:"",actualName:"",gender:void 0,phone:"",departmentId:void 0,email:void 0,positionId:void 0,disabledFlag:void 0,remark:""});const U={actualName:[{required:!0,message:"姓名不能为空"},{max:30,message:"姓名不能大于30个字符",trigger:"blur"}],phone:[{required:!0,message:"手机号不能为空"},{pattern:e.phone,message:"请输入正确的手机号码",trigger:"blur"}],gender:[{required:!0,message:"性别不能为空"}],email:[{required:!0,message:"请输入邮箱"}]};let M=v();async function R(){try{let e=(await i.getLoginInfo()).data;s().setUserLoginInfo(e),w.employeeId=e.employeeId,w.loginName=e.loginName,w.actualName=e.actualName,w.gender=e.gender,w.phone=e.phone,w.departmentId=e.departmentId,w.email=e.email,w.positionId=e.positionId,w.remark=e.remark,w.disabledFlag=e.disabledFlag,M.value=e.avatar}catch(e){o.captureError(e)}}const G=v(".jpg,.jpeg,.png,.gif"),L=v(10),S=v(r.COMMON.value);let T=v(!1);function Y(e,a){const t=e.name.lastIndexOf("."),l=e.name.substring(t<=-1?0:t);if(-1===G.value.indexOf(l))return p.error(`只支持上传 ${G.value.replaceAll(","," ")} 格式的文件`),!1;return!!(e.size/1024/1024<L.value)||(p.error(`单个文件大小必须小于 ${L.value} Mb`),!1)}async function $(e){T.value=!0;try{const a=new FormData;a.append("file",e.file);let t=(await n.uploadFile(a,S.value)).data;M.value=t.fileUrl;let l={avatar:t.fileKey};await u.updateAvatar(l),p.success("更新成功"),await R()}catch(a){o.captureError(a)}finally{T.value=!1}}function J(){c.value.validate().then((()=>{!async function(){d.show();try{await u.updateCenter(w),p.success("更新成功"),await R()}catch(e){o.captureError(e)}finally{d.hide()}}()})).catch((e=>{p.error("参数验证错误，请仔细填写表单数据!")}))}return g((()=>{R()})),(e,r)=>{const i=_("a-input"),o=_("a-form-item"),n=_("a-textarea"),u=_("a-form"),d=_("a-button"),m=_("a-col"),p=_("loading-outlined"),v=_("plus-outlined"),f=_("a-upload"),g=_("a-row");return y(),j("div",E,[F,h("div",q,[b(g,null,{default:I((()=>[b(m,{flex:"350px"},{default:I((()=>[b(u,{ref_key:"formRef",ref:c,model:x(w),rules:U,layout:"vertical"},{default:I((()=>[b(o,{label:"登录账号",name:"loginName"},{default:I((()=>[b(i,{class:"form-item",value:x(w).loginName,"onUpdate:value":r[0]||(r[0]=e=>x(w).loginName=e),valueModifiers:{trim:!0},placeholder:"请输入登录账号",disabled:""},null,8,["value"])])),_:1}),b(o,{label:"部门",name:"departmentId"},{default:I((()=>[b(a,{class:"form-item",ref:"departmentTreeSelect",width:"100%",init:!1,value:x(w).departmentId,"onUpdate:value":r[1]||(r[1]=e=>x(w).departmentId=e),disabled:""},null,8,["value"])])),_:1}),b(o,{label:"员工名称",name:"actualName"},{default:I((()=>[b(i,{class:"form-item",value:x(w).actualName,"onUpdate:value":r[2]||(r[2]=e=>x(w).actualName=e),valueModifiers:{trim:!0},placeholder:"请输入员工名称"},null,8,["value"])])),_:1}),b(o,{label:"性别",name:"gender"},{default:I((()=>[b(l,{class:"form-item",value:x(w).gender,"onUpdate:value":r[3]||(r[3]=e=>x(w).gender=e),placeholder:"请选择性别","enum-name":"GENDER_ENUM"},null,8,["value"])])),_:1}),b(o,{label:"手机号码",name:"phone"},{default:I((()=>[b(i,{class:"form-item",value:x(w).phone,"onUpdate:value":r[4]||(r[4]=e=>x(w).phone=e),valueModifiers:{trim:!0},placeholder:"请输入手机号码"},null,8,["value"])])),_:1}),b(o,{label:"邮箱",name:"email"},{default:I((()=>[b(i,{value:x(w).email,"onUpdate:value":r[5]||(r[5]=e=>x(w).email=e),valueModifiers:{trim:!0},placeholder:"请输入邮箱"},null,8,["value"])])),_:1}),b(o,{label:"职务",name:"positionId"},{default:I((()=>[b(t,{value:x(w).positionId,"onUpdate:value":r[6]||(r[6]=e=>x(w).positionId=e),placeholder:"请选择职务"},null,8,["value"])])),_:1}),b(o,{label:"备注",name:"remark"},{default:I((()=>[b(n,{class:"form-item",value:x(w).remark,"onUpdate:value":r[7]||(r[7]=e=>x(w).remark=e),placeholder:"请输入备注",rows:4},null,8,["value"])])),_:1})])),_:1},8,["model"]),b(d,{type:"primary",onClick:J},{default:I((()=>[N("更新个人信息")])),_:1})])),_:1}),b(m,{flex:"auto"},{default:I((()=>[b(u,{style:{"padding-left":"80px"},layout:"vertical"},{default:I((()=>[b(o,{label:"头像",name:"avatar"},{default:I((()=>[z,b(f,{name:"avatar","list-type":"picture-card",class:"avatar-uploader","show-upload-list":!1,headers:{Authorization:"Bearer "+x(s)().getToken},customRequest:$,"before-upload":Y},{default:I((()=>[x(M)?(y(),j("div",A,[h("img",{src:x(M),class:"avatar-image",alt:"avatar"},null,8,C),O])):(y(),j("div",B,[x(T)?(y(),k(p,{key:0})):(y(),k(v,{key:1})),D]))])),_:1},8,["headers"])])),_:1})])),_:1})])),_:1})])),_:1})])])}}}),[["__scopeId","data-v-ea4f12a5"]]);export{R as default};
