import{u as a}from"./vue-router-D-yLC68c.js";import{V as e,S as s,h as l,B as t,R as o,O as i,A as c,l as r,u as n,W as u,s as d,a as m}from"./index-CBkxY9s9.js";import{l as p,w as v,a as g,d as f,q as h,b as j,f as y,g as w}from"./google-icon-BXU_orIT.js";import{b}from"./ant-design-vue-CcohkicM.js";import{d as C,a as _,r as k,e as x,l as U,b2 as E,b as I,o as N,ai as q,u as D,c as S,bz as z,ag as A,ah as B,J as L,be as M,aY as O,aW as R}from"./@vue-BVvo-xZd.js";import"./@ant-design-D2dl84QQ.js";import"./vue-Bbq_A2bw.js";import"./@ctrl-DlzbjsCp.js";import"./lodash-2VbGH-WW.js";import"./vue3-json-viewer-DGFKKWPN.js";import"./dayjs-B6vKC6dp.js";import"./vue-i18n-CEbWPeBD.js";import"./@intlify-D18cTrFw.js";import"./pinia-CgN6MZDh.js";import"./axios-BlN9Xwzv.js";import"./crypto-js-TV0Ce7JK.js";import"./sm-crypto-CWaozmhJ.js";import"./jsbn-DBh4-X7k.js";import"./nprogress-CqoNXQnd.js";import"./mitt-CNZ6avp8.js";import"./@babel-rSvM8Ko2.js";import"./resize-observer-polyfill-OVnto9HH.js";import"./@emotion-DXlYAqfy.js";import"./stylis-YutRQeBK.js";import"./vue-types-Sy1fKJ9U.js";import"./dom-align-CCb293uS.js";import"./lodash-es-BgZ_dRTG.js";import"./async-validator-BTKOuuO-.js";import"./throttle-debounce-w9OM8Bxz.js";const F=a=>(O("data-v-82eaad65"),a=a(),R(),a),K={class:"login-container"},T={class:"box-item desc"},V=F((()=>q("div",{class:"welcome"},[q("p",null,"欢迎登录 SmartAdmin V3"),q("p",{class:"sub-welcome"},"「高质量代码、简洁、高效、安全」的开发平台")],-1))),W=["src"],$={class:"box-item login"},H=["src"],J=F((()=>q("div",{class:"login-title"},"账号登录",-1))),P=["src"],Y=F((()=>q("span",null," ( 账号：admin, 密码：123456)",-1))),G={class:"more"},Q=F((()=>q("div",{class:"title-box"},[q("p",{class:"line"}),q("p",{class:"title"},"其他方式登录"),q("p",{class:"line"})],-1))),X={class:"login-type"},Z=["src"],aa=["src"],ea=["src"],sa=["src"],la=["src"],ta=["src"],oa=["src"],ia=m(C({__name:"login",setup(m){const C=_({loginName:"admin",password:"",captchaCode:"",captchaUuid:"",loginDevice:e.PC.value}),O={loginName:[{required:!0,message:"用户名不能为空"}],password:[{required:!0,message:"密码不能为空"}],captchaCode:[{required:!0,message:"验证码不能为空"}]},R=k(!1),F=a(),ia=k(),ca=k(!1);async function ra(){ia.value.validate().then((async()=>{try{s.show();let a=Object.assign({},C,{password:l(C.password)});const e=await t.login(a);null!=da&&(clearInterval(da),da=null),o(i.USER_TOKEN,e.data.token?e.data.token:""),b.success("登录成功"),c().setUserLoginInfo(e.data);const d=await r.getAllDictData();n().initData(d.data),u(),F.push("/home")}catch(a){a.data&&0!==a.data.code&&(C.captchaCode="",ua()),d.captureError(a)}finally{s.hide()}}))}x((()=>{document.onkeyup=a=>{13===a.keyCode&&ra()}})),U((()=>{document.onkeyup=null}));const na=k("");async function ua(){try{let e=await t.getCaptcha();na.value=e.data.captchaBase64Image,C.captchaUuid=e.data.captchaUuid,a=e.data.expireSeconds,null===da&&(da=setInterval(ua,1e3*(a-5)))}catch(e){}var a}let da=null;x((()=>{ua(),async function(){try{let a=await t.getTwoFactorLoginFlag();ma.value=a.data}catch(a){d.captureError(a)}}()}));const ma=k(!1);let pa=k("获取邮箱验证码"),va=k(!1),ga=null;async function fa(){try{s.show();await t.sendLoginEmailCode(C.loginName);b.success("验证码发送成功!请登录邮箱查看验证码~"),function(){va.value=!0;let a=60;pa.value=`${a}秒后重新获取`,ga=setInterval((()=>{a>1?(a--,pa.value=`${a}秒后重新获取`):(clearInterval(ga),va.value=!1,pa.value="获取验证码")}),1e3)}()}catch(a){d.captureError(a)}finally{s.hide()}}return(a,e)=>{const s=E("a-input"),l=E("a-form-item"),t=E("a-button"),o=E("a-input-group"),i=E("a-input-password"),c=E("a-checkbox"),r=E("a-form");return N(),I("div",K,[q("div",T,[V,q("img",{class:"welcome-img",src:D("/gif/login-min-C5MBv5eH.gif")},null,8,W)]),q("div",$,[q("img",{class:"login-qr",src:D(p)},null,8,H),J,S(r,{ref_key:"formRef",ref:ia,class:"login-form",model:C,rules:O},{default:z((()=>[S(l,{name:"loginName"},{default:z((()=>[S(s,{value:C.loginName,"onUpdate:value":e[0]||(e[0]=a=>C.loginName=a),valueModifiers:{trim:!0},placeholder:"请输入用户名"},null,8,["value"])])),_:1}),ma.value?(N(),A(l,{key:0,name:"emailCode"},{default:z((()=>[S(o,{compact:""},{default:z((()=>[S(s,{style:{width:"calc(100% - 110px)"},value:C.emailCode,"onUpdate:value":e[1]||(e[1]=a=>C.emailCode=a),autocomplete:"on",placeholder:"请输入邮箱验证码"},null,8,["value"]),S(t,{onClick:fa,class:"code-btn",type:"primary",disabled:D(va)},{default:z((()=>[L(M(D(pa)),1)])),_:1},8,["disabled"])])),_:1})])),_:1})):B("",!0),S(l,{name:"password"},{default:z((()=>[S(i,{value:C.password,"onUpdate:value":e[2]||(e[2]=a=>C.password=a),autocomplete:"on",type:R.value?"text":"password",placeholder:"请输入密码：至少三种字符，最小 8 位"},null,8,["value","type"])])),_:1}),S(l,{name:"captchaCode"},{default:z((()=>[S(s,{class:"captcha-input",value:C.captchaCode,"onUpdate:value":e[3]||(e[3]=a=>C.captchaCode=a),valueModifiers:{trim:!0},placeholder:"请输入验证码"},null,8,["value"]),q("img",{class:"captcha-img",src:na.value,onClick:ua},null,8,P)])),_:1}),S(l,null,{default:z((()=>[S(c,{checked:ca.value,"onUpdate:checked":e[4]||(e[4]=a=>ca.value=a)},{default:z((()=>[L("记住密码")])),_:1},8,["checked"]),Y])),_:1}),S(l,null,{default:z((()=>[q("div",{class:"btn",onClick:ra},"登录")])),_:1})])),_:1},8,["model"]),q("div",G,[Q,q("div",X,[q("img",{src:D(v)},null,8,Z),q("img",{src:D(g)},null,8,aa),q("img",{src:D(f)},null,8,ea),q("img",{src:D(h)},null,8,sa),q("img",{src:D(j)},null,8,la),q("img",{src:D(y)},null,8,ta),q("img",{src:D(w)},null,8,oa)])])])])}}}),[["__scopeId","data-v-82eaad65"]]);export{ia as default};
