import{_ as e}from"./lodash-2VbGH-WW.js";import{c as a,d as t,P as o,e as l,s,S as i,a as r}from"./index-CBkxY9s9.js";import n from"./index-BxS3ZiML.js";import d from"./index-YusmPVuh.js";import p from"./index-4R1yp0EH.js";import{_ as u}from"./index.vue_vue_type_script_setup_true_lang-CtW6JKpO.js";import{T as m}from"./table-id-const-DES3cCFe.js";import{b as c,M as y}from"./ant-design-vue-CcohkicM.js";import{E as v}from"./@ant-design-D2dl84QQ.js";import{d as g,r as f,a as h,w as j,m as _,b2 as w,z as b,ag as x,o as k,bz as I,ai as C,c as z,J as N,y as S,u as E,b as F,ah as T,F as M,be as O}from"./@vue-BVvo-xZd.js";import"./vue3-json-viewer-DGFKKWPN.js";import"./dayjs-B6vKC6dp.js";import"./vue-i18n-CEbWPeBD.js";import"./@intlify-D18cTrFw.js";import"./vue-Bbq_A2bw.js";import"./pinia-CgN6MZDh.js";import"./axios-BlN9Xwzv.js";import"./crypto-js-TV0Ce7JK.js";import"./sm-crypto-CWaozmhJ.js";import"./jsbn-DBh4-X7k.js";import"./nprogress-CqoNXQnd.js";import"./vue-router-D-yLC68c.js";import"./mitt-CNZ6avp8.js";import"./@babel-rSvM8Ko2.js";import"./@ctrl-DlzbjsCp.js";import"./resize-observer-polyfill-OVnto9HH.js";import"./@emotion-DXlYAqfy.js";import"./stylis-YutRQeBK.js";import"./vue-types-Sy1fKJ9U.js";import"./dom-align-CCb293uS.js";import"./lodash-es-BgZ_dRTG.js";import"./async-validator-BTKOuuO-.js";import"./throttle-debounce-w9OM8Bxz.js";import"./role-api-CQ_zWWSq.js";import"./index.vue_vue_type_script_setup_true_lang-Ca0kUvG5.js";import"./department-api-Dth9G_6l.js";import"./index.vue_vue_type_script_setup_true_lang-D394UfoC.js";import"./index.vue_vue_type_script_setup_true_lang-xi4AYrGW.js";import"./position-api-DKbDvSIj.js";import"./regular-const-vBMlR054.js";import"./index-BO1x0V16.js";import"./department-mitt-DFEu9DtT.js";import"./clipboard-C-7VXt_e.js";import"./sortablejs-CRp0PNdb.js";const D={class:"header"},L={class:"query-operate"},P={class:"btn-group"},U={class:"smart-table-column-operate"},R={key:2},q={key:3,class:"smart-table-operate"},A={class:"smart-query-table-page"},V=r(g({__name:"index",props:{departmentId:Number,breadcrumb:Array},setup(r){const g=r;let V=f();function B(e,a){V.value.showModal(e,a)}const G=f([{title:"姓名",dataIndex:"actualName",width:85},{title:"性别",dataIndex:"gender",width:70},{title:"登录账号",dataIndex:"loginName",width:100},{title:"手机号",dataIndex:"phone",width:85},{title:"邮箱",dataIndex:"email",width:100,ellipsis:!0},{title:"超管",dataIndex:"administratorFlag",width:60},{title:"状态",dataIndex:"disabledFlag",width:60},{title:"职务",dataIndex:"positionName",width:100,ellipsis:!0},{title:"角色",dataIndex:"roleNameList",width:100},{title:"部门",dataIndex:"departmentName",ellipsis:!0,width:200},{title:"操作",dataIndex:"operate",width:140}]),Y=f();let J={departmentId:void 0,disabledFlag:!1,keyword:void 0,searchCount:void 0,pageNum:1,pageSize:a,sortItemList:void 0};const $=h({...J}),K=f(0);function Q(){Object.assign($,J),Z()}const X=f(!1);async function Z(){X.value=!0;try{$.departmentId=g.departmentId;let a=await l.queryEmployee($);for(const t of a.data.list)t.roleNameList=e.join(t.roleNameList,",");Y.value=a.data.list,K.value=a.data.total,W.value=[],ee.value=[]}catch(a){s.captureError(a)}finally{X.value=!1}}async function H(a){X.value=!0;try{$.pageNum=1,$.departmentId=a?void 0:g.departmentId;let t=await l.queryEmployee($);for(const a of t.data.list)a.roleNameList=e.join(a.roleNameList,",");Y.value=t.data.list,K.value=t.data.total,W.value=[],ee.value=[]}catch(t){s.captureError(t)}finally{X.value=!1}}j((()=>g.departmentId),(()=>{g.departmentId!==$.departmentId&&($.pageNum=1,Z())}),{immediate:!0});let W=f([]),ee=f([]);const ae=_((()=>W.value.length>0));function te(e,a){W.value=e,ee.value=a}function oe(){if(!ae.value)return void c.warning("请选择要删除的员工");const a=ee.value.map((e=>e.actualName)),t=ee.value.map((e=>e.employeeId));y.confirm({title:"确定要删除如下员工吗?",icon:z(v),content:e.join(a,","),okText:"删除",okType:"danger",async onOk(){i.show();try{await l.batchDeleteEmployee(t),c.success("删除成功"),Z(),W.value=[],ee.value=[]}catch(e){s.captureError(e)}finally{i.hide()}},cancelText:"取消",onCancel(){}})}const le=f();function se(){if(!ae.value)return void c.warning("请选择要调整部门的员工");const e=ee.value.map((e=>e.employeeId));le.value.showModal(e)}const ie=f();function re(a){let t={};a?(t=e.cloneDeep(a),t.disabledFlag=t.disabledFlag?1:0):g.departmentId&&(t.departmentId=g.departmentId),ie.value.showDrawer(t)}return(e,a)=>{const r=w("a-typography-title"),g=w("a-radio-button"),f=w("a-radio-group"),h=w("SearchOutlined"),j=w("a-button"),_=w("a-input-search"),J=w("ReloadOutlined"),ee=w("a-tag"),ae=w("a-table"),ne=w("a-pagination"),de=w("a-card"),pe=b("privilege");return k(),x(de,{class:"employee-container"},{default:I((()=>[C("div",D,[z(r,{level:5},{default:I((()=>[N("部门人员")])),_:1}),C("div",L,[z(f,{value:$.disabledFlag,"onUpdate:value":a[0]||(a[0]=e=>$.disabledFlag=e),style:{margin:"8px","flex-shrink":"0"},onChange:a[1]||(a[1]=e=>H(!1))},{default:I((()=>[z(g,{value:void 0},{default:I((()=>[N("全部")])),_:1}),z(g,{value:!1},{default:I((()=>[N("启用")])),_:1}),z(g,{value:!0},{default:I((()=>[N("禁用")])),_:1})])),_:1},8,["value"]),z(_,{value:$.keyword,"onUpdate:value":a[2]||(a[2]=e=>$.keyword=e),valueModifiers:{trim:!0},placeholder:"姓名/手机号/登录账号",onSearch:a[3]||(a[3]=e=>H(!0))},{enterButton:I((()=>[z(j,{type:"primary"},{icon:I((()=>[z(h)])),default:I((()=>[N(" 查询 ")])),_:1})])),_:1},8,["value"]),z(j,{onClick:Q,class:"smart-margin-left10"},{icon:I((()=>[z(J)])),default:I((()=>[N(" 重置 ")])),_:1})])]),C("div",P,[S((k(),x(j,{class:"btn",type:"primary",onClick:re},{default:I((()=>[N("添加成员")])),_:1})),[[pe,"system:employee:add"]]),S((k(),x(j,{class:"btn",onClick:se},{default:I((()=>[N("调整部门")])),_:1})),[[pe,"system:employee:department:update"]]),S((k(),x(j,{class:"btn",onClick:oe},{default:I((()=>[N("批量删除")])),_:1})),[[pe,"system:employee:delete"]]),C("span",U,[z(u,{modelValue:G.value,"onUpdate:modelValue":a[4]||(a[4]=e=>G.value=e),tableId:E(m).SYSTEM.EMPLOYEE,refresh:Z},null,8,["modelValue","tableId"])])]),z(ae,{"row-selection":{selectedRowKeys:E(W),onChange:te},size:"small",columns:G.value,"data-source":Y.value,pagination:!1,loading:X.value,scroll:{x:1500},"row-key":"employeeId",bordered:""},{bodyCell:I((({text:a,record:t,index:o,column:r})=>["administratorFlag"===r.dataIndex?(k(),F(M,{key:0},[a?(k(),x(ee,{key:0,color:"error"},{default:I((()=>[N("超管")])),_:1})):T("",!0)],64)):T("",!0),"disabledFlag"===r.dataIndex?(k(),x(ee,{key:1,color:a?"error":"processing"},{default:I((()=>[N(O(a?"禁用":"启用"),1)])),_:2},1032,["color"])):"gender"===r.dataIndex?(k(),F("span",R,O(e.$smartEnumPlugin.getDescByValue("GENDER_ENUM",a)),1)):"operate"===r.dataIndex?(k(),F("div",q,[S((k(),x(j,{type:"link",size:"small",onClick:e=>re(t)},{default:I((()=>[N("编辑")])),_:2},1032,["onClick"])),[[pe,"system:employee:update"]]),S((k(),x(j,{type:"link",size:"small",onClick:e=>{return a=t.employeeId,o=t.loginName,void y.confirm({title:"提醒",icon:z(v),content:"确定要重置密码吗?",okText:"确定",okType:"danger",async onOk(){i.show();try{let{data:e}=await l.resetPassword(a);c.success("重置成功"),V.value.showModal(o,e),Z()}catch(e){s.captureError(e)}finally{i.hide()}},cancelText:"取消",onCancel(){}});var a,o}},{default:I((()=>[N("重置密码")])),_:2},1032,["onClick"])),[[pe,"system:employee:password:reset"]]),S((k(),x(j,{type:"link",onClick:e=>{return a=t.employeeId,o=t.disabledFlag,void y.confirm({title:"提醒",icon:z(v),content:`确定要${o?"启用":"禁用"}吗?`,okText:"确定",okType:"danger",async onOk(){i.show();try{await l.updateDisabled(a),c.success((o?"启用":"禁用")+"成功"),Z()}catch(e){s.captureError(e)}finally{i.hide()}},cancelText:"取消",onCancel(){}});var a,o}},{default:I((()=>[N(O(t.disabledFlag?"启用":"禁用"),1)])),_:2},1032,["onClick"])),[[pe,"system:employee:disabled"]])])):T("",!0)])),_:1},8,["row-selection","columns","data-source","loading"]),C("div",A,[z(ne,{showSizeChanger:"",showQuickJumper:"","show-less-items":"",pageSizeOptions:E(o),defaultPageSize:$.pageSize,current:$.pageNum,"onUpdate:current":a[5]||(a[5]=e=>$.pageNum=e),pageSize:$.pageSize,"onUpdate:pageSize":a[6]||(a[6]=e=>$.pageSize=e),total:K.value,onChange:Z,onShowSizeChange:Z,"show-total":E(t)},null,8,["pageSizeOptions","defaultPageSize","current","pageSize","total","show-total"])]),z(n,{ref_key:"employeeFormModal",ref:ie,onRefresh:Z,onShowAccount:B},null,512),z(d,{ref_key:"employeeDepartmentFormModal",ref:le,onRefresh:Z},null,512),z(p,{ref_key:"employeePasswordDialog",ref:V},null,512)])),_:1})}}}),[["__scopeId","data-v-f8984d9c"]]);export{V as default};
