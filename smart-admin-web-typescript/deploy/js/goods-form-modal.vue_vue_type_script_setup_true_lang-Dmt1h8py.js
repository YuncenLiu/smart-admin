import{c as e}from"./category-api-iaRaCfKr.js";import{s as a,g as l,p as t,b as d,u as o,G as s,C as u,D as r,S as i}from"./index-CBkxY9s9.js";import{d as n,r as p,w as c,e as g,b2 as v,ag as m,o as y,aR as f,b as h,c as b,bz as _,F as w,b0 as x,J as S,be as O,a as G,ai as C,u as T,n as I}from"./@vue-BVvo-xZd.js";import{_ as U}from"./lodash-2VbGH-WW.js";import{_ as D}from"./index.vue_vue_type_script_setup_true_lang-D394UfoC.js";import{b as N}from"./ant-design-vue-CcohkicM.js";const j=n({__name:"index",props:{value:Number,placeholder:{type:String,default:"请选择"},categoryType:Number,width:{type:String,default:"100%"}},emits:["update:value","change"],setup(l,{emit:t}){const d=l,o=t,s=p([]);async function u(){if(d.categoryType)try{let a={categoryType:d.categoryType},l=await e.queryCategoryTree(a);s.value=l.data}catch(l){a.captureError(l)}else s.value=[]}const r=p(d.value);function i(e){o("update:value",e),o("change",e)}return c((()=>d.value),(e=>{r.value=e})),c((()=>d.categoryType),(()=>{u()})),g(u),(e,a)=>{const t=v("a-tree-select");return y(),m(t,{value:r.value,"onUpdate:value":a[0]||(a[0]=e=>r.value=e),style:f(`width:${l.width}`),"dropdown-style":{maxHeight:"400px",overflowX:"auto"},"tree-data":s.value,placeholder:l.placeholder,allowClear:!0,"tree-default-expand-all":"",onChange:i},null,8,["value","style","tree-data","placeholder"])}}}),k={addGoods:e=>t("/goods/add",e),deleteGoods:e=>d(`/goods/delete/${e}`),batchDelete:e=>t("/goods/batchDelete",e),queryGoodsList:e=>t("/goods/query",e),updateGoods:e=>t("/goods/update",e),importGoods:e=>t("/goods/importGoods",e),exportGoods:()=>l("/goods/exportGoods")},A=n({__name:"index",props:{dictCode:String,value:[Array,String],mode:{type:String,default:"combobox"},width:{type:String,default:"200px"},placeholder:{type:String,default:"请选择"},size:{type:String,default:"default"},disabled:{type:Boolean,default:!1},disabledOption:{type:Array,default:()=>[]},hiddenOption:{type:Array,default:()=>[]}},emits:["update:value","change"],setup(e,{emit:a}){const l=e,t=p([]);g((function(){let e=o().getDictData(l.dictCode);t.value=e.filter((e=>!l.hiddenOption.includes(e.dataValue)&&!e.disabledFlag))}));const d=p(l.value);c((()=>l.value),(e=>{Array.isArray(e)?d.value=e.filter((e=>!l.disabledOption.includes(e)&&!l.hiddenOption.includes(e))):d.value=l.hiddenOption.includes(e)||l.disabledOption.includes(e)?void 0:e}),{immediate:!0});const s=a;function u(e){s("update:value",e),s("change",e)}return(a,o)=>{const s=v("a-select-option"),r=v("a-select");return y(),h("div",null,[b(r,{value:d.value,"onUpdate:value":o[0]||(o[0]=e=>d.value=e),style:f(`width: ${e.width}`),placeholder:l.placeholder,allowClear:!0,size:e.size,mode:e.mode,onChange:u,disabled:e.disabled},{default:_((()=>[(y(!0),h(w,null,x(t.value,(a=>(y(),m(s,{key:a.dataValue,value:a.dataValue,disabled:e.disabledOption.includes(a.valueCode)},{default:_((()=>[S(O(a.dataLabel),1)])),_:2},1032,["value","disabled"])))),128))])),_:1},8,["value","style","placeholder","size","mode","disabled"])])}}}),q={style:{position:"absolute",right:0,bottom:0,width:"100%",borderTop:"1px solid #e9e9e9",padding:"10px 16px",background:"#fff",textAlign:"right",zIndex:1}},z=n({__name:"goods-form-modal",emits:["reloadList"],setup(e,{expose:l,emit:t}){const d=t,o=p(),n={categoryId:void 0,goodsName:void 0,goodsStatus:s.APPOINTMENT.value,place:[],price:void 0,shelvesFlag:!0,remark:"",goodsId:void 0};let c=G({...n});const g={categoryId:[{required:!0,message:"请选择商品分类"}],goodsName:[{required:!0,message:"商品名称不能为空"}],goodsStatus:[{required:!0,message:"商品状态不能为空"}],price:[{required:!0,message:"商品价格不能为空"}],place:[{required:!0,message:"产地不能为空"}]},f=p(!1);function h(){Object.assign(c,n),f.value=!1}function w(){o.value.validate().then((async()=>{i.show();try{c.goodsId?await k.updateGoods(c):await k.addGoods(c),N.success((c.goodsId?"修改":"添加")+"成功"),h(),d("reloadList")}catch(e){a.captureError(e)}finally{i.hide()}})).catch((e=>{N.error("参数验证错误，请仔细填写表单数据!")}))}return l({showDrawer:function(e){Object.assign(c,n),e&&!U.isEmpty(e)&&Object.assign(c,e),c.place&&c.place.length>0&&(c.place=c.place.split(",")),f.value=!0,I((()=>{o.value.clearValidate()}))}}),(e,a)=>{const l=v("a-form-item"),t=v("a-input"),d=v("a-radio"),s=v("a-radio-group"),i=v("a-input-number"),n=v("a-form"),p=v("a-button"),x=v("a-drawer");return y(),m(x,{title:T(c).goodsId?"编辑":"添加",width:500,open:f.value,"body-style":{paddingBottom:"80px"},onClose:h},{default:_((()=>[b(n,{ref_key:"formRef",ref:o,model:T(c),rules:g,"label-col":{span:5}},{default:_((()=>[b(l,{label:"商品分类",name:"categoryId"},{default:_((()=>[b(j,{value:T(c).categoryId,"onUpdate:value":a[0]||(a[0]=e=>T(c).categoryId=e),placeholder:"请选择商品分类",categoryType:T(u).GOODS.value},null,8,["value","categoryType"])])),_:1}),b(l,{label:"商品名称",name:"goodsName"},{default:_((()=>[b(t,{value:T(c).goodsName,"onUpdate:value":a[1]||(a[1]=e=>T(c).goodsName=e),placeholder:"请输入商品名称"},null,8,["value"])])),_:1}),b(l,{label:"商品状态",name:"goodsStatus"},{default:_((()=>[b(D,{"enum-name":"GOODS_STATUS_ENUM",value:T(c).goodsStatus,"onUpdate:value":a[2]||(a[2]=e=>T(c).goodsStatus=e)},null,8,["value"])])),_:1}),b(l,{label:"产地",name:"place"},{default:_((()=>[b(A,{width:"100%","dict-code":T(r).GOODS_PLACE,value:T(c).place,"onUpdate:value":a[3]||(a[3]=e=>T(c).place=e),mode:"tags"},null,8,["dict-code","value"])])),_:1}),b(l,{label:"上架状态",name:"shelvesFlag"},{default:_((()=>[b(s,{value:T(c).shelvesFlag,"onUpdate:value":a[4]||(a[4]=e=>T(c).shelvesFlag=e)},{default:_((()=>[b(d,{value:!0},{default:_((()=>[S("上架")])),_:1}),b(d,{value:!1},{default:_((()=>[S("下架")])),_:1})])),_:1},8,["value"])])),_:1}),b(l,{label:"商品价格",name:"price"},{default:_((()=>[b(i,{style:{width:"100%"},placeholder:"请输入商品价格",value:T(c).price,"onUpdate:value":a[5]||(a[5]=e=>T(c).price=e),min:0},null,8,["value"])])),_:1}),b(l,{label:"备注",name:"remark"},{default:_((()=>[b(t,{style:{width:"100%"},placeholder:"请输入备注",value:T(c).remark,"onUpdate:value":a[6]||(a[6]=e=>T(c).remark=e)},null,8,["value"])])),_:1})])),_:1},8,["model"]),C("div",q,[b(p,{style:{"margin-right":"8px"},onClick:h},{default:_((()=>[S("取消")])),_:1}),b(p,{type:"primary",onClick:w},{default:_((()=>[S("提交")])),_:1})])])),_:1},8,["title","open"])}}});export{z as _,j as a,A as b,k as g};
