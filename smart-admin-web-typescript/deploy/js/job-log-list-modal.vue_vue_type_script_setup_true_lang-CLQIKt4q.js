import{j as e}from"./job-api-D-3ZlMQ3.js";import{P as a,s as t}from"./index-CBkxY9s9.js";import{_ as l}from"./index.vue_vue_type_script_setup_true_lang-CtW6JKpO.js";import{T as s}from"./table-id-const-DES3cCFe.js";import{d as i,r as o,a as u,b2 as d,ag as r,o as n,bz as c,c as m,J as p,u as g,K as f,ai as h,b as v,ah as y,F as _,be as x}from"./@vue-BVvo-xZd.js";const b={style:{"margin-top":"5px"}},w={key:0,style:{color:"#39c710"}},S={key:1,style:{color:"#f50"}},I={class:"smart-query-table-page"},z=i({__name:"job-log-list-modal",setup(i,{expose:z}){const j=o(!1),T=o("");z({show:function(e,a){C.jobId=e,L(),j.value=!0,T.value=a}});const k=o([{title:"执行人",dataIndex:"createName",width:100,ellipsis:!0},{title:"执行参数",dataIndex:"param",width:80,ellipsis:!0},{title:"执行时间",dataIndex:"executeStartTime",width:200},{title:"执行用时",dataIndex:"executeTimeMillis",width:100,ellipsis:!0},{title:"结果",dataIndex:"successFlag",width:80},{title:"执行结果",dataIndex:"executeResult",ellipsis:!0,width:100},{title:"ip",dataIndex:"ip",width:110},{title:"进程id",dataIndex:"processId",width:60},{title:"程序目录",dataIndex:"programPath",ellipsis:!0}]),O={searchWord:"",jobId:null,successFlag:null,endTime:null,startTime:null,pageNum:1,pageSize:10},C=u({...O}),q=o(!1),U=o([]),F=o(0);let N=o();function P(e,a){C.startTime=a[0],C.endTime=a[1]}function J(){Object.assign(C,O),L()}function W(){C.pageNum=1,L()}async function L(){try{q.value=!0;let a=await e.queryJobLog(C);const t=a.data.list;F.value=a.data.total,U.value=t}catch(a){t.captureError(a)}finally{q.value=!1}}return(e,t)=>{const i=d("a-input"),o=d("a-form-item"),u=d("a-select-option"),z=d("a-select"),O=d("a-range-picker"),M=d("a-space"),R=d("SearchOutlined"),V=d("a-button"),E=d("ReloadOutlined"),K=d("a-button-group"),B=d("a-row"),G=d("a-form"),Q=d("a-tag"),$=d("CheckOutlined"),A=d("WarningOutlined"),D=d("a-table"),H=d("a-pagination"),X=d("a-card"),Y=d("a-drawer");return n(),r(Y,{open:j.value,"onUpdate:open":t[6]||(t[6]=e=>j.value=e),width:1e3,title:T.value,placement:"right",destroyOnClose:!0},{default:c((()=>[m(G,{class:"smart-query-form"},{default:c((()=>[m(B,{class:"smart-query-form-row"},{default:c((()=>[m(o,{label:"关键字",class:"smart-query-form-item"},{default:c((()=>[m(i,{style:{width:"200px"},value:C.searchWord,"onUpdate:value":t[0]||(t[0]=e=>C.searchWord=e),placeholder:"请输入关键字",maxlength:30},null,8,["value"])])),_:1}),m(o,{label:"执行结果",class:"smart-query-form-item"},{default:c((()=>[m(z,{style:{width:"100px"},value:C.successFlag,"onUpdate:value":t[1]||(t[1]=e=>C.successFlag=e),placeholder:"请选择",allowClear:""},{default:c((()=>[(n(),r(u,{key:1},{default:c((()=>[p(" 成功 ")])),_:1})),(n(),r(u,{key:0},{default:c((()=>[p(" 失败 ")])),_:1}))])),_:1},8,["value"])])),_:1}),m(o,{label:"执行时间",class:"smart-query-form-item"},{default:c((()=>[m(M,{direction:"vertical",size:12},{default:c((()=>[m(O,{value:g(N),"onUpdate:value":t[2]||(t[2]=e=>f(N)?N.value=e:N=e),style:{width:"220px"},onChange:P},null,8,["value"])])),_:1})])),_:1}),m(o,{class:"smart-query-form-item smart-margin-left10"},{default:c((()=>[m(K,null,{default:c((()=>[m(V,{type:"primary",onClick:W},{icon:c((()=>[m(R)])),default:c((()=>[p(" 查询 ")])),_:1}),m(V,{onClick:J},{icon:c((()=>[m(E)])),default:c((()=>[p(" 重置 ")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),m(X,{size:"small",bordered:!1,hoverable:!0},{default:c((()=>[m(B,{justify:"end"},{default:c((()=>[m(l,{class:"smart-margin-bottom5",modelValue:k.value,"onUpdate:modelValue":t[3]||(t[3]=e=>k.value=e),tableId:g(s).SUPPORT.JOB_LOG,refresh:L},null,8,["modelValue","tableId"])])),_:1}),m(D,{size:"small",loading:q.value,bordered:"",dataSource:U.value,columns:k.value,rowKey:"jobLogId",pagination:!1},{bodyCell:c((({record:e,column:a})=>["executeStartTime"===a.dataIndex?(n(),v(_,{key:0},[h("div",null,[m(Q,{color:"green"},{default:c((()=>[p("始")])),_:1}),p(x(e.executeStartTime),1)]),h("div",b,[m(Q,{color:"blue"},{default:c((()=>[p("终")])),_:1}),p(x(e.executeEndTime),1)])],64)):y("",!0),"executeTimeMillis"===a.dataIndex?(n(),v(_,{key:1},[p(x(e.executeTimeMillis)+" ms ",1)],64)):y("",!0),"successFlag"===a.dataIndex?(n(),v(_,{key:2},[e.successFlag?(n(),v("div",w,[m($),p("成功")])):(n(),v("div",S,[m(A),p("失败")]))],64)):y("",!0)])),_:1},8,["loading","dataSource","columns"]),h("div",I,[m(H,{showSizeChanger:"",showQuickJumper:"","show-less-items":"",pageSizeOptions:g(a),defaultPageSize:C.pageSize,current:C.pageNum,"onUpdate:current":t[4]||(t[4]=e=>C.pageNum=e),pageSize:C.pageSize,"onUpdate:pageSize":t[5]||(t[5]=e=>C.pageSize=e),total:F.value,onChange:L,onShowSizeChange:L,"show-total":e=>`共${e}条`},null,8,["pageSizeOptions","defaultPageSize","current","pageSize","total","show-total"])])])),_:1})])),_:1},8,["open","title"])}}});export{z as _};
