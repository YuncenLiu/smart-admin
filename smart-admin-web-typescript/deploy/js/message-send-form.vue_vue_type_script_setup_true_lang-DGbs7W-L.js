import{w as e,S as a,x as s,s as t}from"./index-CBkxY9s9.js";import{_ as l}from"./index.vue_vue_type_script_setup_true_lang-D394UfoC.js";import{_ as r}from"./message-receiver-modal.vue_vue_type_script_setup_true_lang-DNXGvfv6.js";import{b as n}from"./ant-design-vue-CcohkicM.js";import{d as o,r as i,a as u,b2 as c,b as d,o as m,F as p,c as v,bz as f,u as _,ai as y,J as g,be as b,n as h}from"./@vue-BVvo-xZd.js";const U=o({__name:"message-send-form",emits:["reloadList"],setup(o,{expose:U,emit:w}){const E=w,L=i(!1);function T(){Object.assign(j,M),L.value=!1}const I=i(),M={title:void 0,receiverUserIdList:null,content:null,messageType:null,receiverUserType:e.ADMIN_EMPLOYEE.value};let j=u({...M});const k={title:[{required:!0,message:"标题 必填"}],content:[{required:!0,message:"推送内容 必填"}],receiverUserIdList:[{required:!0,message:"推送人 必填"}],messageType:[{required:!0,message:"消息类型 必填"}]},x=i();function C(e,a){j.receiverUserIdList=e,x.value=a.join(",")}const O=i();function q(){O.value.showModal(j.receiverUserIdList)}async function A(){try{await I.value.validateFields(),async function(){a.show();try{let a=[];for(const s of j.receiverUserIdList)a.push({title:j.title,receiverUserId:s,content:j.content,messageType:j.messageType,receiverUserType:e.ADMIN_EMPLOYEE.value});await s.sendMessages(a),n.success("操作成功"),E("reloadList"),T()}catch(l){t.captureError(l)}finally{a.hide()}}()}catch(l){n.error("参数验证错误，请仔细填写表单数据!")}}return U({show:function(e){Object.assign(j,M),x.value=null,L.value=!0,h((()=>{I.value.clearValidate()}))}}),(e,a)=>{const s=c("a-input"),t=c("a-form-item"),n=c("a-button"),o=c("a-textarea"),i=c("a-form"),u=c("a-space"),h=c("a-modal");return m(),d(p,null,[v(h,{title:"添加",width:700,open:L.value,onCancel:T,maskClosable:!1,destroyOnClose:!0},{footer:f((()=>[v(u,null,{default:f((()=>[v(n,{onClick:T},{default:f((()=>[g("取消")])),_:1}),v(n,{type:"primary",onClick:A},{default:f((()=>[g("保存")])),_:1})])),_:1})])),default:f((()=>[v(i,{ref_key:"formRef",ref:I,model:_(j),rules:k,"label-col":{span:5},"wrapper-col":{span:16}},{default:f((()=>[v(t,{label:"标题",name:"title"},{default:f((()=>[v(s,{style:{width:"100%"},value:_(j).title,"onUpdate:value":a[0]||(a[0]=e=>_(j).title=e),placeholder:"标题"},null,8,["value"])])),_:1}),v(t,{label:"接收人",name:"receiverUserIdList"},{default:f((()=>[v(n,{onClick:q,type:"primary"},{default:f((()=>[g(" 选择接收人 ")])),_:1}),y("div",null,b(x.value),1)])),_:1}),v(t,{label:"消息类型",name:"messageType"},{default:f((()=>[v(l,{width:"100%",value:_(j).messageType,"onUpdate:value":a[1]||(a[1]=e=>_(j).messageType=e),placeholder:"请选择类型","enum-name":"MESSAGE_TYPE_ENUM"},null,8,["value"])])),_:1}),v(t,{label:"推送内容",name:"content"},{default:f((()=>[v(o,{style:{width:"100%"},value:_(j).content,"onUpdate:value":a[2]||(a[2]=e=>_(j).content=e),placeholder:"推送内容"},null,8,["value"])])),_:1})])),_:1},8,["model"])])),_:1},8,["open"]),v(r,{ref_key:"receiverModalRef",ref:O,onReloadList:C},null,512)],64)}}});export{U as _};
