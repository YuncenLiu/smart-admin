import{d as e,r as l,a,b2 as t,b as i,o,F as s,c as n,bz as u,y as r,b0 as d,ag as c,J as m,be as p,ai as v,E as f,u as h,n as b}from"./@vue-BVvo-xZd.js";import{_ as y}from"./lodash-2VbGH-WW.js";import{d as g}from"./dayjs-B6vKC6dp.js";import{U as j,F as _,S as T,s as w,a as F}from"./index-CBkxY9s9.js";import{n as I}from"./notice-api-BS5_b2B9.js";import{W as k}from"./index-DwfIiKZa.js";import{_ as x}from"./notice-form-visible-modal.vue_vue_type_script_setup_true_lang-Qy6bjgrV.js";import{b as C,M as V}from"./ant-design-vue-CcohkicM.js";import"./@ant-design-D2dl84QQ.js";import"./vue-Bbq_A2bw.js";import"./@ctrl-DlzbjsCp.js";import"./vue3-json-viewer-DGFKKWPN.js";import"./vue-i18n-CEbWPeBD.js";import"./@intlify-D18cTrFw.js";import"./pinia-CgN6MZDh.js";import"./axios-BlN9Xwzv.js";import"./crypto-js-TV0Ce7JK.js";import"./sm-crypto-CWaozmhJ.js";import"./jsbn-DBh4-X7k.js";import"./nprogress-CqoNXQnd.js";import"./vue-router-D-yLC68c.js";import"./mitt-CNZ6avp8.js";import"./@babel-rSvM8Ko2.js";import"./resize-observer-polyfill-OVnto9HH.js";import"./@emotion-DXlYAqfy.js";import"./stylis-YutRQeBK.js";import"./vue-types-Sy1fKJ9U.js";import"./dom-align-CCb293uS.js";import"./lodash-es-BgZ_dRTG.js";import"./async-validator-BTKOuuO-.js";import"./throttle-debounce-w9OM8Bxz.js";import"./@wangeditor-next-CoIDXbIU.js";import"./notice-form-visible-transfer-department-BXYZI4in.js";import"./department-api-Dth9G_6l.js";import"./notice-form-visible-transfer-employee-B5ZDBDwx.js";const L={class:"visible-list"},U="YYYY-MM-DD HH:mm:ss",N=F(e({__name:"notice-form-drawer",emits:["reloadList"],setup(e,{expose:F,emit:N}){const E=N,H=l(!1);function R(){H.value=!1}const M=l(),q=l(),O=l(),S={noticeId:void 0,noticeTypeId:void 0,title:void 0,categoryId:void 0,source:void 0,documentNumber:void 0,author:void 0,allVisibleFlag:1,visibleRangeList:[],scheduledPublishFlag:!1,publishTime:void 0,attachment:[],contentHtml:"",contentText:""},Y=a({...S}),z={title:[{required:!0,message:"请输入"}],noticeTypeId:[{required:!0,message:"请选择分类"}],allVisibleFlag:[{required:!0,message:"请选择"}],source:[{required:!0,message:"请输入来源"}],author:[{required:!0,message:"请输入作者"}],contentHtml:[{required:!0,message:"请输入内容"}]};async function P(){try{Y.contentHtml=q.value.getHtml(),Y.contentText=q.value.getText(),await M.value.validateFields(),async function(){try{T.show(),Y.allVisibleFlag&&(Y.visibleRangeList=[]),Y.publishTime||(Y.publishTime=g().format(U)),Y.noticeId?await I.updateNotice(Y):await I.addNotice(Y),C.success("保存成功"),E("reloadList"),R()}catch(e){w.captureError(e)}finally{T.hide()}}()}catch(e){C.error("参数验证错误，请仔细填写表单数据!")}}const D=l([]);function A(){const e=Y.visibleRangeList||[];O.value.showModal(e)}function J(e){Y.visibleRangeList=e}const W=l(null);function B(e,l){Y.publishTime=l}function G(e){W.value=e?g():null,Y.publishTime=e?g().format(U):null}const K=l([]);function Q(e){K.value=e,Y.attachment=y.isEmpty(e)?[]:e}return F({showModal:function(e){Object.assign(Y,S),W.value=null,K.value=[],async function(){try{const e=await I.getAllNoticeTypeList();D.value=e.data,D.value.length>0&&!Y.noticeId&&(Y.noticeTypeId=D.value[0].noticeTypeId)}catch(e){w.captureError(e)}}(),e&&async function(e){try{T.show();const l=await I.getUpdateNoticeInfo(e),a=l.data.attachment;y.isEmpty(a)?K.value=[]:K.value=a,Object.assign(Y,l.data),Y.allVisibleFlag=Y.allVisibleFlag?1:0,W.value=g(l.data.publishTime),H.value=!0}catch(l){w.captureError(l)}finally{T.hide()}}(e),H.value=!0,b((()=>{M.value.clearValidate()}))}}),(e,l)=>{const a=t("a-input"),b=t("a-form-item"),y=t("a-select-option"),g=t("a-select"),T=t("a-button"),w=t("close-outlined"),F=t("a-tag"),I=t("a-switch"),C=t("a-date-picker"),N=t("a-form"),E=t("a-space"),S=t("a-drawer");return o(),i(s,null,[n(S,{title:Y.noticeId?"编辑":"新建",open:H.value,width:1e3,footerStyle:{textAlign:"right"},onClose:R,destroyOnClose:!0},{footer:u((()=>[n(E,null,{default:u((()=>[n(T,{onClick:R},{default:u((()=>[m("取消")])),_:1}),n(T,{type:"primary",onClick:P},{default:u((()=>[m("保存")])),_:1})])),_:1})])),default:u((()=>[n(N,{ref_key:"formRef",ref:M,model:Y,rules:z,"label-col":{span:3},"wrapper-col":{span:20}},{default:u((()=>[n(b,{label:"公告标题",name:"title"},{default:u((()=>[n(a,{value:Y.title,"onUpdate:value":l[0]||(l[0]=e=>Y.title=e),placeholder:"请输入公告标题"},null,8,["value"])])),_:1}),n(b,{label:"分类",name:"noticeTypeId"},{default:u((()=>[n(g,{value:Y.noticeTypeId,"onUpdate:value":l[1]||(l[1]=e=>Y.noticeTypeId=e),style:{width:"100%"},showSearch:!0,allowClear:!0},{default:u((()=>[(o(!0),i(s,null,d(D.value,(e=>(o(),c(y,{key:e.noticeTypeId,value:e.noticeTypeId},{default:u((()=>[m(p(e.noticeTypeName),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"])])),_:1}),n(b,{label:"文号"},{default:u((()=>[n(a,{value:Y.documentNumber,"onUpdate:value":l[2]||(l[2]=e=>Y.documentNumber=e),placeholder:"文号，如：1024创新实验室发〔2022〕字第36号"},null,8,["value"])])),_:1}),n(b,{label:"作者",name:"author"},{default:u((()=>[n(a,{value:Y.author,"onUpdate:value":l[3]||(l[3]=e=>Y.author=e),placeholder:"请输入作者"},null,8,["value"])])),_:1}),n(b,{label:"来源",name:"source"},{default:u((()=>[n(a,{value:Y.source,"onUpdate:value":l[4]||(l[4]=e=>Y.source=e),placeholder:"请输入来源"},null,8,["value"])])),_:1}),n(b,{label:"可见范围",name:"allVisibleFlag"},{default:u((()=>[n(g,{value:Y.allVisibleFlag,"onUpdate:value":l[5]||(l[5]=e=>Y.allVisibleFlag=e),placeholder:"请选择可见范围"},{default:u((()=>[n(y,{value:1},{default:u((()=>[m("全部可见")])),_:1}),n(y,{value:0},{default:u((()=>[m("部分可见")])),_:1})])),_:1},8,["value"])])),_:1}),r(n(b,{label:"可见员工/部门"},{default:u((()=>[n(T,{type:"primary",onClick:A},{default:u((()=>[m("选择")])),_:1}),v("div",L,[(o(!0),i(s,null,d(Y.visibleRangeList,((e,l)=>(o(),i("div",{class:"visible-item",key:e.dataId},[n(F,null,{default:u((()=>[v("span",null,p(e.dataName),1),n(w,{onClick:e=>function(e){V.confirm({title:"提示",content:"确定移除吗？",onOk(){Y.visibleRangeList.splice(e,1)}})}(l)},null,8,["onClick"])])),_:2},1024)])))),128))])])),_:1},512),[[f,!Y.allVisibleFlag]]),n(b,{label:"定时发布"},{default:u((()=>[n(I,{checked:Y.scheduledPublishFlag,"onUpdate:checked":l[6]||(l[6]=e=>Y.scheduledPublishFlag=e),"checked-children":"开","un-checked-children":"关",onChange:G},null,8,["checked"])])),_:1}),r(n(b,{label:"发布时间"},{default:u((()=>[n(C,{value:W.value,"onUpdate:value":l[7]||(l[7]=e=>W.value=e),format:U,showTime:"",allowClear:!1,placeholder:"请选择发布时间",style:{width:"200px"},onChange:B},null,8,["value"])])),_:1},512),[[f,Y.scheduledPublishFlag]]),n(b,{label:"公告内容",name:"contentHtml"},{default:u((()=>[n(k,{ref_key:"contentRef",ref:q,modelValue:Y.contentHtml,height:300},null,8,["modelValue"])])),_:1}),n(b,{label:"附件"},{default:u((()=>[n(j,{defaultFileList:K.value,maxUploadSize:10,folder:h(_).NOTICE.value,buttonText:"上传附件",listType:"text",extraMsg:"最多上传10个附件",onChange:Q},null,8,["defaultFileList","folder"])])),_:1})])),_:1},8,["model"])])),_:1},8,["title","open"]),n(x,{ref_key:"noticeFormVisibleModal",ref:O,onSelectedFinish:J},null,512)],64)}}}),[["__scopeId","data-v-0dcd586f"]]);export{N as default};
