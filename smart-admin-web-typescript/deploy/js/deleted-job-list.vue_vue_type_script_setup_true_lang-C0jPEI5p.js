import{j as e}from"./job-api-D-3ZlMQ3.js";import{T as a,P as t,s as l}from"./index-CBkxY9s9.js";import{_ as i}from"./job-log-list-modal.vue_vue_type_script_setup_true_lang-CLQIKt4q.js";import{T as o}from"./table-id-const-DES3cCFe.js";import{_ as d}from"./index.vue_vue_type_script_setup_true_lang-CtW6JKpO.js";import{d as s,r,a as n,e as u,b2 as c,z as p,b as g,o as m,c as b,ai as y,bz as f,F as h,b0 as v,ag as _,J as x,be as k,y as w,u as I,ah as j}from"./@vue-BVvo-xZd.js";const T={class:"smart-table-setting-block smart-margin-bottom10"},S={key:0},z=y("div",null,"下次执行(预估时间)",-1),C={key:5,class:"smart-table-operate"},J={class:"smart-query-table-page"},F=s({__name:"deleted-job-list",setup(s){const F=r([{title:"id",width:50,dataIndex:"jobId"},{title:"任务名称",dataIndex:"jobName",minWidth:150,ellipsis:!0},{title:"执行类",dataIndex:"jobClass",minWidth:180,ellipsis:!0},{title:"触发类型",dataIndex:"triggerType",width:110},{title:"触发配置",dataIndex:"triggerValue",width:150},{title:"上次执行",width:180,dataIndex:"lastJob"},{title:"下次执行",width:150,dataIndex:"nextJob"},{title:"启用状态",dataIndex:"enabledFlag",width:100},{title:"执行参数",dataIndex:"param",ellipsis:!0},{title:"任务描述",dataIndex:"remark",ellipsis:!0},{title:"排序",dataIndex:"sort",width:65},{title:"更新人",dataIndex:"updateName",width:90},{title:"更新时间",dataIndex:"updateTime",width:150},{title:"操作",dataIndex:"action",fixed:"right",width:70}]),q={searchWord:"",enabledFlag:null,triggerType:null,deletedFlag:!0,pageNum:1,pageSize:10},L=n({...q}),O=r(!1),E=r([]),N=r(0);function U(){Object.assign(L,q),D()}function P(){L.pageNum=1,D()}async function D(){try{O.value=!0;let a=await e.queryJob(L);const t=a.data.list;N.value=a.data.total,E.value=t}catch(a){l.captureError(a)}finally{O.value=!1}}u(D);const R=r();return(e,l)=>{const s=c("a-input"),r=c("a-form-item"),n=c("a-select-option"),u=c("a-select"),q=c("SearchOutlined"),W=c("a-button"),V=c("ReloadOutlined"),G=c("a-button-group"),M=c("a-row"),Y=c("a-form"),$=c("a-flex"),A=c("a-tooltip"),B=c("a-tag"),K=c("CheckOutlined"),Q=c("WarningOutlined"),X=c("a-switch"),H=c("a-table"),Z=c("a-pagination"),ee=p("privilege");return m(),g("div",null,[b(Y,{class:"smart-query-form"},{default:f((()=>[b(M,{class:"smart-query-form-row"},{default:f((()=>[b(r,{label:"关键字",class:"smart-query-form-item"},{default:f((()=>[b(s,{style:{width:"200px"},value:L.searchWord,"onUpdate:value":l[0]||(l[0]=e=>L.searchWord=e),placeholder:"请输入关键字",maxlength:30},null,8,["value"])])),_:1}),b(r,{label:"触发类型",class:"smart-query-form-item"},{default:f((()=>[b(u,{style:{width:"155px"},value:L.triggerType,"onUpdate:value":l[1]||(l[1]=e=>L.triggerType=e),placeholder:"请选择触发类型",allowClear:""},{default:f((()=>[(m(!0),g(h,null,v(e.$smartEnumPlugin.getValueDescList("TRIGGER_TYPE_ENUM"),(e=>(m(),_(n,{key:e.value,value:e.value},{default:f((()=>[x(k(e.desc),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"])])),_:1}),b(r,{label:"状态",class:"smart-query-form-item"},{default:f((()=>[b(u,{style:{width:"150px"},value:L.enabledFlag,"onUpdate:value":l[2]||(l[2]=e=>L.enabledFlag=e),placeholder:"请选择状态",allowClear:""},{default:f((()=>[(m(),_(n,{key:1},{default:f((()=>[x(" 开启 ")])),_:1})),(m(),_(n,{key:0},{default:f((()=>[x(" 停止 ")])),_:1}))])),_:1},8,["value"])])),_:1}),b(r,{class:"smart-query-form-item smart-margin-left10"},{default:f((()=>[b(G,null,{default:f((()=>[w((m(),_(W,{type:"primary",onClick:P},{icon:f((()=>[b(q)])),default:f((()=>[x(" 查询 ")])),_:1})),[[ee,"support:job:query"]]),w((m(),_(W,{onClick:U},{icon:f((()=>[b(V)])),default:f((()=>[x(" 重置 ")])),_:1})),[[ee,"support:job:query"]])])),_:1})])),_:1})])),_:1})])),_:1}),b($,{align:"end",vertical:""},{default:f((()=>[y("div",T,[b(d,{class:"smart-margin-bottom5 pull-right",modelValue:F.value,"onUpdate:modelValue":l[3]||(l[3]=e=>F.value=e),tableId:I(o).SUPPORT.JOB,refresh:D},null,8,["modelValue","tableId"])])])),_:1}),b(H,{scroll:{x:1800},size:"small",loading:O.value,bordered:"",dataSource:E.value,columns:F.value,rowKey:"jobId",pagination:!1},{bodyCell:f((({record:e,column:t})=>["jobClass"===t.dataIndex?(m(),_(A,{key:0},{title:f((()=>[x(k(e.jobClass),1)])),default:f((()=>{return[x(" "+k((a=e.jobClass,a.split(".").pop())),1)];var a})),_:2},1024)):j("",!0),"triggerType"===t.dataIndex?(m(),g(h,{key:1},[e.triggerType===I(a).CRON.value?(m(),_(B,{key:0,color:"success"},{default:f((()=>[x(k(e.triggerTypeDesc),1)])),_:2},1024)):e.triggerType===I(a).FIXED_DELAY.value?(m(),_(B,{key:1,color:"processing"},{default:f((()=>[x(k(e.triggerTypeDesc),1)])),_:2},1024)):(m(),_(B,{key:2,color:"pink"},{default:f((()=>[x(k(e.triggerTypeDesc),1)])),_:2},1024))],64)):j("",!0),"lastJob"===t.dataIndex?(m(),g(h,{key:2},[e.lastJobLog?(m(),g("div",S,[b(A,null,{title:f((()=>{return[x(k((a=e.lastJobLog.executeResult,a?a.substring(0,400)+(a.length>400?" ...":""):"")),1)];var a})),default:f((()=>[e.lastJobLog.successFlag?(m(),_(K,{key:0,style:{color:"#39c710"}})):(m(),_(Q,{key:1,style:{color:"#f50"}})),x(" "+k(e.lastJobLog.executeStartTime),1)])),_:2},1024)])):j("",!0)],64)):j("",!0),"nextJob"===t.dataIndex?(m(),g(h,{key:3},[e.enabledFlag&&e.nextJobExecuteTimeList?(m(),_(A,{key:0},{title:f((()=>[z,(m(!0),g(h,null,v(e.nextJobExecuteTimeList,(e=>(m(),g("div",{key:e},k(e),1)))),128))])),default:f((()=>[x(" "+k(e.nextJobExecuteTimeList[0]),1)])),_:2},1024)):j("",!0)],64)):j("",!0),"enabledFlag"===t.dataIndex?(m(),_(X,{key:4,"checked-children":"已启用","un-checked-children":"已禁用",checked:e.enabledFlag,"onUpdate:checked":a=>e.enabledFlag=a,disabled:"",loading:e.enabledLoading},null,8,["checked","onUpdate:checked","loading"])):j("",!0),"action"===t.dataIndex?(m(),g("div",C,[w((m(),_(W,{onClick:a=>{return t=e.jobId,l=e.jobName,void R.value.show(t,l);var t,l},type:"link"},{default:f((()=>[x("记录")])),_:2},1032,["onClick"])),[[ee,"support:job:log:query"]])])):j("",!0)])),_:1},8,["loading","dataSource","columns"]),y("div",J,[b(Z,{showSizeChanger:"",showQuickJumper:"","show-less-items":"",pageSizeOptions:I(t),defaultPageSize:L.pageSize,current:L.pageNum,"onUpdate:current":l[4]||(l[4]=e=>L.pageNum=e),pageSize:L.pageSize,"onUpdate:pageSize":l[5]||(l[5]=e=>L.pageSize=e),total:N.value,onChange:D,onShowSizeChange:D,"show-total":e=>`共${e}条`},null,8,["pageSizeOptions","defaultPageSize","current","pageSize","total","show-total"])]),b(i,{ref_key:"jobLogModal",ref:R},null,512)])}}});export{F as _};
