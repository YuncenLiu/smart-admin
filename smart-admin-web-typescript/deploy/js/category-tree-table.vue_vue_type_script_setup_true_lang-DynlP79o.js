import{C as e,s as a,S as t}from"./index-CBkxY9s9.js";import{_ as o}from"./category-form-modal.vue_vue_type_script_setup_true_lang-CuJtvV9e.js";import{c as r}from"./category-api-iaRaCfKr.js";import{M as l,b as c}from"./ant-design-vue-CcohkicM.js";import{d as n,m as s,r as i,a as d,e as u,b2 as y,z as p,ag as g,o as m,bz as f,c as v,ai as b,y as k,J as _,b as x,ah as C}from"./@vue-BVvo-xZd.js";const T={class:"smart-table-operate-block"},h=b("div",{class:"smart-table-setting-block"},null,-1),w={key:0,class:"smart-table-operate"},I=n({__name:"category-tree-table",props:{categoryType:Number,privilegePrefix:{type:String,default:""}},setup(n,{expose:I}){const P=[{categoryType:e.GOODS.value,columnName:"商品分类"},{categoryType:e.DEMO.value,columnName:"演示分类"}],j=s((()=>{let e=P.find((e=>e.categoryType===N.categoryType));return e?e.columnName:""})),N=n,O=i(!1),S=i([]),z=d([{title:j,dataIndex:"categoryName"},{title:"操作",dataIndex:"action",width:200}]);async function E(){try{O.value=!0;let e={categoryType:N.categoryType},a=await r.queryCategoryTree(e);S.value=a.data}catch(e){a.captureError(e)}finally{O.value=!1}}const M=i([]);function $(e){E(),e&&M.value.push(e)}function D(e){M.value=e}u(E),I({queryList:E});const q=i();function L(e,a){q.value.showModal(N.categoryType,e,a)}function R(e){l.confirm({title:"提示",content:"确定要删除当前分类吗?",okText:"确定",okType:"danger",async onOk(){!async function(e){try{t.show(),await r.deleteCategoryById(e),c.success("删除成功"),E()}catch(o){a.captureError(o)}finally{t.hide()}}(e)},cancelText:"取消",onCancel(){}})}return(e,a)=>{const t=y("PlusOutlined"),r=y("a-button"),l=y("a-row"),c=y("a-table"),s=y("a-card"),i=p("privilege");return m(),g(s,{size:"small",bordered:!1,hoverable:!0},{default:f((()=>[v(l,{class:"smart-table-btn-block"},{default:f((()=>[b("div",T,[k((m(),g(r,{onClick:a[0]||(a[0]=e=>L()),type:"primary"},{icon:f((()=>[v(t)])),default:f((()=>[_(" 新建 ")])),_:1})),[[i,`${n.privilegePrefix}category:add`]])]),h])),_:1}),v(c,{scroll:{x:1e3},size:"small",dataSource:S.value,columns:z,rowKey:"categoryId",bordered:"",pagination:!1,onExpandedRowsChange:D,"expanded-row-keys":M.value},{bodyCell:f((({record:e,column:a})=>["action"===a.dataIndex?(m(),x("div",w,[k((m(),g(r,{onClick:a=>L(e.categoryId),type:"link"},{default:f((()=>[_("增加子分类")])),_:2},1032,["onClick"])),[[i,`${n.privilegePrefix}category:addChild`]]),k((m(),g(r,{onClick:a=>L(void 0,e),type:"link"},{default:f((()=>[_("编辑")])),_:2},1032,["onClick"])),[[i,`${n.privilegePrefix}category:update`]]),k((m(),g(r,{onClick:a=>R(e.categoryId),danger:"",type:"link"},{default:f((()=>[_("删除")])),_:2},1032,["onClick"])),[[i,`${n.privilegePrefix}category:delete`]])])):C("",!0)])),_:1},8,["dataSource","columns","expanded-row-keys"]),v(o,{ref_key:"formModal",ref:q,onReloadList:$},null,512)])),_:1})}}});export{I as _};
