import{_ as e}from"./lodash-2VbGH-WW.js";import{_ as a}from"./help-doc-catalog-form-modal.vue_vue_type_script_setup_true_lang-C2iDctNO.js";import{t,S as l,s as o,a as s}from"./index-CBkxY9s9.js";import{m as r}from"./mitt-CNZ6avp8.js";import{M as c}from"./ant-design-vue-CcohkicM.js";import{E as n}from"./@ant-design-D2dl84QQ.js";import{d as i,r as p,e as u,w as d,l as h,b2 as v,z as m,ag as f,o as y,bz as g,c as C,ah as k,b as j,ai as I,y as D,J as _,F as w,u as b,aR as x,be as E}from"./@vue-BVvo-xZd.js";import"./help-doc-catalog-tree-select.vue_vue_type_script_setup_true_lang-BLyeRJ10.js";import"./vue3-json-viewer-DGFKKWPN.js";import"./dayjs-B6vKC6dp.js";import"./vue-i18n-CEbWPeBD.js";import"./@intlify-D18cTrFw.js";import"./vue-Bbq_A2bw.js";import"./pinia-CgN6MZDh.js";import"./axios-BlN9Xwzv.js";import"./crypto-js-TV0Ce7JK.js";import"./sm-crypto-CWaozmhJ.js";import"./jsbn-DBh4-X7k.js";import"./nprogress-CqoNXQnd.js";import"./vue-router-D-yLC68c.js";import"./@babel-rSvM8Ko2.js";import"./@ctrl-DlzbjsCp.js";import"./resize-observer-polyfill-OVnto9HH.js";import"./@emotion-DXlYAqfy.js";import"./stylis-YutRQeBK.js";import"./vue-types-Sy1fKJ9U.js";import"./dom-align-CCb293uS.js";import"./lodash-es-BgZ_dRTG.js";import"./async-validator-BTKOuuO-.js";import"./throttle-debounce-w9OM8Bxz.js";const M=r(),K={style:{display:"flex","flex-direction":"column"}},z={key:0,class:"sort-span"},S={key:1},T={key:2,class:"no-data"},B=s(i({__name:"help-doc-catalog-tree",props:{checkable:{type:Boolean,default:!1},checkStrictly:{type:Boolean,default:!1},height:Number,showMenu:{type:Boolean,default:!0}},setup(s,{expose:r}){const i=s,B=p(),R=p([]),U=p([]),A=p(new Map),F=p(!1);async function H(){await L(),Y.value&&G(Y.value)}async function L(){let a=(await t.getAll()).data;R.value=a,U.value=N(a,0),a.forEach((e=>{A.value.set(e.helpDocCatalogId,e)})),!e.isEmpty(U.value)&&U.value.length>0&&(B.value=U.value[0].helpDocCatalogId,G(U.value[0].helpDocCatalogId))}function N(a,t){let l=a.filter((e=>e.parentId===t))||[];return l=e.sortBy(l,(e=>e.sort)),l.forEach((e=>{e.children=N(a,e.helpDocCatalogId)})),function(e){for(let a=0;a<e.length;a++)0!==a?a!==e.length-1?(e[a].preId=e[a-1].helpDocCatalogId,e[a].nextId=e[a+1].helpDocCatalogId):(e[a].preId=e[a-1].helpDocCatalogId,e[a].nextId=void 0):e[a].nextId=e.length>1?e[1].helpDocCatalogId:void 0}(l),l}u((()=>{L()}));const O=p([]),q=p([]),J=p([]),Y=p(),$=p([]);function G(e){O.value=[e],P(O.value)}function P(a){if(e.isEmpty(a))return J.value=[],void($.value=[]);let t=a[0];$.value=R.value.filter((e=>e.parentId===t));let l=[];V(l,t,!0),J.value=l.map((e=>e.name))}M.on("selectTree",G);const Q=p("");function V(e,a,t){let l=A.value.get(a);l&&!e.some((e=>e.helpDocCatalogId===a))&&(t?e.unshift(l):e.push(l),l.parentId&&0!==l.parentId&&V(e,l.parentId,t))}d((()=>Q.value),(()=>{!function(){if(!Q.value)return void(U.value=N(R.value,0));let e=R.value.concat();if(!e)return;let a=e.filter((e=>e.name.indexOf(Q.value)>-1)),t=[];a.forEach((e=>{V(t,e.helpDocCatalogId,!1)})),U.value=N(t,0)}()}));const W=p();function X(){W.value.showModal({helpDocCatalogId:0,name:"",parentId:0})}return h((()=>{M.all.clear()})),r({queryHelpDocCatalogTree:L,selectedHelpDocCatalogChildren:$,breadcrumb:J,selectedKeys:O,checkedKeys:q,keywords:Q}),(r,p)=>{const u=v("a-input"),d=v("a-row"),h=v("a-switch"),M=v("a-button"),A=v("a-popover"),N=v("a-tree"),J=v("a-card"),$=m("privilege");return y(),f(J,{class:"tree-container",size:"small"},{default:g((()=>[C(d,null,{default:g((()=>[C(u,{value:Q.value,"onUpdate:value":p[0]||(p[0]=e=>Q.value=e),valueModifiers:{trim:!0},placeholder:"请输入目录名称"},null,8,["value"])])),_:1}),i.showMenu?(y(),f(d,{key:0,class:"sort-flag-row"},{default:g((()=>[I("span",null,[_(" 排序 "),F.value?(y(),j(w,{key:0},[_(" （越小越靠前） ")],64)):k("",!0),_(" ："),C(h,{checked:F.value,"onUpdate:checked":p[1]||(p[1]=e=>F.value=e)},null,8,["checked"])]),D((y(),f(M,{type:"primary",onClick:X,size:"small"},{default:g((()=>[_("新建")])),_:1})),[[$,"support:helpDocCatalog:addCategory"]])])),_:1})):k("",!0),b(e).isEmpty(U.value)?(y(),j("div",T,"暂无结果")):(y(),f(N,{key:1,selectedKeys:O.value,"onUpdate:selectedKeys":p[2]||(p[2]=e=>O.value=e),checkedKeys:q.value,"onUpdate:checkedKeys":p[3]||(p[3]=e=>q.value=e),class:"tree",treeData:U.value,fieldNames:{title:"name",key:"helpDocCatalogId",value:"helpDocCatalogId"},style:x([{width:"100%","overflow-x":"auto"},[s.height?{height:`${s.height}px`,overflowY:"auto"}:""]]),showLine:!i.checkable,checkable:i.checkable,checkStrictly:i.checkStrictly,selectable:!i.checkable,defaultExpandAll:!0,onSelect:P},{title:g((a=>[i.showMenu?(y(),f(A,{key:0,placement:"right"},{content:g((()=>[I("div",K,[D((y(),f(M,{type:"text",onClick:e=>function(e){let a={helpDocCatalogId:0,name:"",parentId:e.helpDocCatalogId};Y.value=e.helpDocCatalogId,W.value.showModal(a)}(a.dataRef)},{default:g((()=>[_("添加下级")])),_:2},1032,["onClick"])),[[$,"support:helpDocCatalog:addCategory"]]),D((y(),f(M,{type:"text",onClick:e=>{return t=a.dataRef,Y.value=t.helpDocCatalogId,void W.value.showModal(t);var t}},{default:g((()=>[_("修改")])),_:2},1032,["onClick"])),[[$,"support:helpDocCatalog:edit"]]),a.helpDocCatalogId!==B.value?D((y(),f(M,{key:0,type:"text",onClick:s=>{return r=a.helpDocCatalogId,void c.confirm({title:"提醒",icon:C(n),content:"确定要删除该目录吗?",okText:"删除",okType:"danger",async onOk(){l.show();try{let a=null;if(!e.isEmpty(O.value)&&(a=O.value[0],a===r)){let e=R.value.find((e=>e.helpDocCatalogId===r));e&&e.parentId&&(a=e.parentId)}await t.delete(r),await L(),a&&G(a)}catch(a){o.captureError(a)}finally{l.hide()}},cancelText:"取消",onCancel(){}});var r}},{default:g((()=>[_("删除")])),_:2},1032,["onClick"])),[[$,"support:helpDocCatalog:delete"]]):k("",!0)])])),default:g((()=>[_(" "+E(a.name)+" ",1),F.value?(y(),j("span",z,"("+E(a.sort)+")",1)):k("",!0)])),_:2},1024)):(y(),j("div",S,E(a.name),1))])),_:1},8,["selectedKeys","checkedKeys","treeData","style","showLine","checkable","checkStrictly","selectable"])),C(a,{ref_key:"helpDocCatalogFormModal",ref:W,onRefresh:H},null,512)])),_:1})}}}),[["__scopeId","data-v-57997c39"]]);export{B as default};
