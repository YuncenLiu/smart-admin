import{_ as e}from"./lodash-2VbGH-WW.js";import{b as t,p as l,S as a,s as n,a as o,i as s}from"./index-CBkxY9s9.js";import{d as u,r,n as c,b2 as i,ag as d,o as m,bz as p,b as f,u as h,c as y,J as b,be as g,ah as v,aP as w,F as x,y as k,E as C,ai as F,aY as E,aW as _,a as I,w as S,e as z}from"./@vue-BVvo-xZd.js";import{S as T}from"./sortablejs-CRp0PNdb.js";import{b as D,M as q}from"./ant-design-vue-CcohkicM.js";const L=e=>l("/support/tableColumn/update",e),O=e=>t(`/support/tableColumn/getColumns/${e}`),K=e=>t(`/support/tableColumn/delete/${e}`);function j(t,l){let a=!1;if(!l)return t;let n=new Map;for(const e of l)n.set(e.columnKey,e);let o=1,s=[];for(const e of t){e.columnKey=e.dataIndex,e.showFlag=!0,e.sort=o;let t=n.get(e.columnKey);t&&(e.sort=t.sort,e.showFlag=t.showFlag,e.dragAndDropFlag?(a=!0,delete e.dragAndDropFlag):t.width&&(e.width=t.width)),s.push(e),o++}return s=e.sortBy(s,(e=>e.sort)),{newColumns:s,saveFlag:a}}const V=e=>(E("data-v-2b24fe43"),e=e(),_(),e),M={key:0},R=V((()=>F("br",null,null,-1))),A=V((()=>F("br",null,null,-1))),N=V((()=>F("br",null,null,-1))),B=V((()=>F("br",null,null,-1))),J=V((()=>F("br",null,null,-1))),U=V((()=>F("br",null,null,-1))),X={key:1},$={key:0,class:"smart-table-operate"},P=o(u({__name:"smart-table-column-modal",emits:["change"],setup(t,{expose:l,emit:o}){const s=o;l({show:function(t,l){u=l,F.value=!0,async function(e,t){if(!e)return;a.show();let l=[];try{let t=await O(e);if(t.data)try{l=JSON.parse(t.data)}catch(s){n.captureError(s)}}catch(u){n.captureError(u)}finally{a.hide()}let o=j(t,l);I.value=o.newColumns,_.value=o.saveFlag;for(const a of I.value)a.showFlag&&V.value.push(a.columnKey);_.value&&G(!1);c((()=>{!function(){let e=document.querySelector("#smartTableColumnModalTable tbody");T.create(e,{animation:300,dragClass:"smart-ghost-class",ghostClass:"smart-ghost-class",chosenClass:"smart-ghost-class",handle:".handle",onEnd({newIndex:e,oldIndex:t}){e!==t&&z(t,e)}})}()}))}(u,e.cloneDeep(t))}});let u=null;const F=r(!1);function E(){F.value=!1}const _=r(!1);const I=r([]),S=[{title:"列",dataIndex:"title"},{title:"宽度(像素)",dataIndex:"width",width:150},{title:"操作",dataIndex:"operate",width:150,rowDrag:!0}];function z(e,t){const l=I.value.splice(e,1)[0];I.value.splice(t,0,l)}const V=r([]);function P(e){V.value=e}const W=r(!1);function Y(){q.confirm({title:"确定要恢复默认吗？",content:"确定恢复默认后，该信息将不可恢复",okText:"确定恢复",okType:"danger",onOk(){(async()=>{W.value=!0;try{await K(u),D.success("恢复默认成功"),s("change",[]),E()}catch(e){n.captureError(e)}finally{W.value=!1}})()},cancelText:"取消",onCancel(){}})}async function G(t=!0){W.value=!0;try{let l=[];for(let e=0;e<I.value.length;e++){let t=I.value[e],a={columnKey:t.columnKey,sort:e+1};t.width&&(a.width=t.width),a.showFlag=V.value.indexOf(t.columnKey)>-1,l.push(a)}l=e.sortBy(l,(e=>e.sort)),await L({tableId:u,columnList:l}),s("change",l),t&&(D.success("保存成功"),E())}catch(l){n.captureError(l)}finally{W.value=!1}}return(e,t)=>{const l=i("a-alert"),a=i("smile-outlined"),n=i("pushpin-outlined"),o=i("drag-outlined"),s=i("a-button"),r=i("a-input-number"),c=i("a-table"),_=i("a-modal");return m(),d(_,{width:800,open:F.value,title:"设置列",destroyOnClose:!0,closable:!1},{footer:p((()=>[y(s,{key:"back",onClick:E},{default:p((()=>[b("取消")])),_:1}),h(u)?(m(),d(s,{key:"submit",type:"primary",loading:W.value,onClick:G},{default:p((()=>[b("保存")])),_:1},8,["loading"])):v("",!0),h(u)?(m(),d(s,{key:"back",loading:W.value,onClick:Y,danger:"",style:{"margin-left":"20px"}},{default:p((()=>[b("恢复默认")])),_:1},8,["loading"])):v("",!0)])),default:p((()=>[h(u)?(m(),f("div",X,[y(l,{type:"info","show-icon":"",class:"smart-margin-bottom10"},{icon:p((()=>[y(a)])),message:p((()=>[b(" 可以通过拖拽行直接修改顺序哦；（ "),y(n),b("为固定列，不可拖拽 ）")])),_:1}),y(c,{id:"smartTableColumnModalTable",rowKey:"columnKey","row-class-name":"column-row",columns:S,dataSource:I.value,rowSelection:{checkStrictly:!1,selectedRowKeys:V.value,onChange:P},pagination:!1,size:"small",bordered:""},{bodyCell:p((({text:e,record:t,index:l,column:a})=>["title"===a.dataIndex?(m(),d(s,{key:0,type:"text",class:w(t.fixed?"":"handle"),size:"small",style:{width:"100%","text-align":"left"}},{icon:p((()=>[t.fixed?(m(),d(n,{key:1})):(m(),d(o,{key:0}))])),default:p((()=>[b(" "+g(e),1)])),_:2},1032,["class"])):v("",!0),"width"===a.dataIndex?(m(),f(x,{key:1},[y(r,{value:t.width,"onUpdate:value":e=>t.width=e,style:{width:"90px","margin-left":"10px","margin-right":"3px"},size:"small"},null,8,["value","onUpdate:value"]),b("px ")],64)):v("",!0),"operate"===a.dataIndex?(m(),f(x,{key:2},[t.fixed?v("",!0):(m(),f("div",$,[k(y(s,{onClick:e=>function(e){let t=e-1;t<0||I.value[t].fixed||z(e,t)}(l),type:"link",class:"handle",size:"small",style:{"margin-right":"12px"}},{default:p((()=>[b(" 上移 ")])),_:2},1032,["onClick"]),[[C,l>0]]),k(y(s,{onClick:e=>function(e){let t=e+1;t>=I.value.length||I.value[t].fixed||z(e,t)}(l),type:"link",class:"handle",size:"small"},{default:p((()=>[b(" 下移")])),_:2},1032,["onClick"]),[[C,l!==I.value.length-1]])]))],64)):v("",!0)])),_:1},8,["dataSource","rowSelection"])])):(m(),f("div",M,[y(l,{type:"error","show-icon":"",class:"smart-margin-bottom10"},{message:p((()=>[b(" 您尚未设置 TableOperator 组件的 tableId")])),_:1}),y(l,{type:"error",class:"smart-margin-bottom10"},{message:p((()=>[b(" 1. 请在 src\\constants\\support\\table-id-const.js 中配置 tableId 常量 "),R,A,b(" 2. 在自己的业务表格页面组件中使用如下： "),N,b(" 导入: import { TABLE_ID_CONST } from '/@/constants/support/table-id-const'; "),B,b(" 使用: "+g('<TableOperator v-model="columns" :tableId="TABLE_ID_CONST.BUSINESS.XXX" :refresh="queryData" />')+" "),J,U,b(" 3. 具体用法可参考员工管理 ")])),_:1})]))])),_:1},8,["open"])}}}),[["__scopeId","data-v-2b24fe43"]]),W=u({__name:"index",props:{modelValue:{type:Array,default:[]},refresh:{type:Function,required:!0},tableId:{type:Number,require:!0}},emits:["update:modelValue"],setup(t,{emit:l}){const a=t,o=l;let u=I(e.cloneDeep(a.modelValue)),c=I(e.cloneDeep(a.modelValue));async function h(){if(!a.tableId)return;let e=[];try{let l=await O(a.tableId);if(l.data)try{e=JSON.parse(l.data)}catch(t){n.captureError(t)}}catch(l){n.captureError(l)}F(e)}S((()=>a.modelValue),(e=>{c.forEach((t=>{e.forEach((e=>{t.dataIndex==e.dataIndex&&Object.assign(t,e)}))}))}),{deep:!0}),z(h);const b=r(!1);function g(){b.value?(w(),document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()):(b.value=!0,s().startFullScreen(),function(e){e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullScreen?e.webkitRequestFullScreen():e.msRequestFullscreen?e.msRequestFullscreen():D.error("当前浏览器不支持部分全屏！");document.addEventListener("fullscreenchange",x),document.addEventListener("mozfullscreenchange",x),document.addEventListener("webkitfullscreenchange",x),document.addEventListener("MSFullscreenChange",x)}(document.body))}function w(){b.value=!1,s().exitFullScreen(),document.removeEventListener("fullscreenchange",x),document.removeEventListener("mozfullscreenchange",x),document.removeEventListener("webkitfullscreenchange",x),document.removeEventListener("MSFullscreenChange",x)}function x(){document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement||w()}const k=r();function C(){k.value.show(c,a.tableId)}function F(t){let l={};l=e.isEmpty(t)?j(e.cloneDeep(u),t):j(e.cloneDeep(c),t);const a=l.newColumns;c.forEach((e=>{l.newColumns.forEach((t=>{e.dataIndex==t.dataIndex&&Object.assign(e,t)}))})),o("update:modelValue",a.filter((e=>e.showFlag)))}return S((()=>a.tableId),(t=>{t&&(u=e.cloneDeep(a.modelValue),c=e.cloneDeep(a.modelValue),h())}),{immediate:!0}),(e,t)=>{const l=i("fullscreen-outlined"),n=i("a-button"),o=i("a-tooltip"),s=i("fullscreen-exit-outlined"),u=i("redo-outlined"),r=i("setting-outlined");return m(),f("span",null,[b.value?v("",!0):(m(),d(o,{key:0,title:"全屏"},{default:p((()=>[y(n,{type:"text",onClick:g,size:"small"},{icon:p((()=>[y(l)])),_:1})])),_:1})),b.value?(m(),d(o,{key:1,title:"取消全屏"},{default:p((()=>[y(n,{type:"text",onClick:g,size:"small"},{icon:p((()=>[y(s)])),_:1})])),_:1})):v("",!0),y(o,{title:"刷新"},{default:p((()=>[y(n,{type:"text",onClick:a.refresh,size:"small"},{icon:p((()=>[y(u)])),_:1},8,["onClick"])])),_:1}),y(o,{title:"列设置"},{default:p((()=>[y(n,{type:"text",onClick:C,size:"small"},{icon:p((()=>[y(r)])),_:1})])),_:1}),y(P,{ref_key:"smartTableColumnModal",ref:k,onChange:F},null,512)])}}});export{W as _};
